<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n Cafetera</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #2E8B57;
        }
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 10px 20px;
            margin: 0 5px;
            background: #2E8B57;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .tab-button:hover {
            background: #3CB371;
        }
        .tab-button.active {
            background: #3CB371;
        }
        .form-container {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .form-container.active {
            display: block;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #2E8B57;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #3CB371;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #2E8B57;
            color: white;
        }
        .report-section {
            margin-top: 40px;
        }
        .report-section h2 {
            color: #2E8B57;
            border-bottom: 2px solid #2E8B57;
            padding-bottom: 10px;
        }
        .export-buttons {
            margin-top: 20px;
        }
        .detalle-lote {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå± Sistema de Gesti√≥n Cafetera</h1>

        <!-- Pesta√±as -->
        <div class="tabs">
            <button class="tab-button active" onclick="mostrarFormulario('lotes')">üå± Lotes</button>
            <button class="tab-button" onclick="mostrarFormulario('actividades')">üë∑ Actividades</button>
            <button class="tab-button" onclick="mostrarFormulario('insumos')">üõí Insumos</button>
            <button class="tab-button" onclick="mostrarFormulario('usoInsumos')">üì¶ Uso de Insumos</button>
            <button class="tab-button" onclick="mostrarFormulario('reportes')">üìä Reportes</button>
        </div>

        <!-- Formulario de Lotes -->
        <div id="lotes" class="form-container active">
            <h2>Registro de Lotes</h2>
            <form id="loteForm">
                <div class="form-group">
                    <label>N¬∞ Lote:</label>
                    <input type="number" id="numeroLote" required>
                </div>
                <div class="form-group">
                    <label>Variedad:</label>
                    <select id="variedad" required>
                        <option value="">Seleccione</option>
                        <option>Castillo</option>
                        <option>Cenicafe</option>
                        <option>Colombia</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>√Årea (ha):</label>
                    <input type="number" step="0.01" id="area" required>
                </div>
                <div class="form-group">
                    <label>Surco (m):</label>
                    <input type="number" step="0.01" id="surco" required>
                </div>
                <div class="form-group">
                    <label>Entre plantas (m):</label>
                    <input type="number" step="0.01" id="plantas" required>
                </div>
                <button type="button" onclick="guardarLote()">Guardar Lote</button>
            </form>
        </div>

        <!-- Formulario de Actividades -->
        <div id="actividades" class="form-container">
            <h2>üë∑ Registro de Actividades</h2>
            <form id="actividadForm">
                <div class="form-group">
                    <label>Lote:</label>
                    <select id="loteActividad" required></select>
                </div>
                <div class="form-group">
                    <label>Tipo de Labor:</label>
                    <select id="tipoLabor" required>
                        <option value="">Seleccione</option>
                        <option>Siembra</option>
                        <option>Fertilizaci√≥n</option>
                        <option>Poda</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>N¬∞ Jornales:</label>
                    <input type="number" id="jornales" step="0.5" required>
                </div>
                <div class="form-group">
                    <label>Valor por Jornal:</label>
                    <input type="number" id="valorJornal" step="1000" required>
                </div>
                <button type="button" onclick="guardarActividad()">Guardar Actividad</button>
            </form>
        </div>

        <!-- Formulario de Insumos -->
        <div id="insumos" class="form-container">
            <h2>üõí Registro de Insumos</h2>
            <form id="insumoForm">
                <div class="form-group">
                    <label>Insumo:</label>
                    <input type="text" id="nombreInsumo" required>
                </div>
                <div class="form-group">
                    <label>Cantidad:</label>
                    <input type="number" id="cantidadInsumo" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Unidad de Medida:</label>
                    <select id="unidadMedida" required>
                        <option>Kilo</option>
                        <option>Litro</option>
                        <option>Bulto</option>
                    </select>
                </div>
                <button type="button" onclick="guardarInsumo()">Guardar Insumo</button>
            </form>
        </div>

        <!-- Formulario de Uso de Insumos -->
        <div id="usoInsumos" class="form-container">
            <h2>üì¶ Uso de Insumos</h2>
            <form id="usoInsumoForm">
                <div class="form-group">
                    <label>Lote:</label>
                    <select id="loteUsoInsumo" required></select>
                </div>
                <div class="form-group">
                    <label>Insumo:</label>
                    <select id="insumoDisponible" required></select>
                </div>
                <div class="form-group">
                    <label>Cantidad a usar:</label>
                    <input type="number" id="cantidadUso" step="0.01" required>
                </div>
                <button type="button" onclick="registrarUsoInsumo()">Registrar Uso</button>
            </form>
        </div>

        <!-- Reportes -->
        <div id="reportes" class="form-container">
            <h2>üìä Reportes</h2>
            <div class="report-section">
                <h3>Resumen de Lotes</h3>
                <table id="tablaLotes">
                    <thead>
                        <tr>
                            <th>N¬∞ Lote</th>
                            <th>Variedad</th>
                            <th>√Årea (ha)</th>
                            <th>Densidad (pl/ha)</th>
                            <th>Total Plantas</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <div class="export-buttons">
                    <button onclick="exportarPDF('tablaLotes', 'Reporte_Lotes.pdf')">Exportar a PDF</button>
                    <button onclick="exportarExcel('tablaLotes', 'Reporte_Lotes.xlsx')">Exportar a Excel</button>
                </div>
            </div>

            <!-- Detalle del Lote -->
            <div id="detalleLote" class="detalle-lote" style="display: none;">
                <h3>Detalle del Lote</h3>
                <div id="detalleLoteContent"></div>
            </div>

            <div class="report-section">
                <h3>Resumen de Actividades</h3>
                <table id="tablaActividades">
                    <thead>
                        <tr>
                            <th>Lote</th>
                            <th>Actividad</th>
                            <th>Jornales</th>
                            <th>Valor Total</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <div class="export-buttons">
                    <button onclick="exportarPDF('tablaActividades', 'Reporte_Actividades.pdf')">Exportar a PDF</button>
                    <button onclick="exportarExcel('tablaActividades', 'Reporte_Actividades.xlsx')">Exportar a Excel</button>
                </div>
            </div>

            <div class="report-section">
                <h3>Resumen de Insumos</h3>
                <table id="tablaInsumos">
                    <thead>
                        <tr>
                            <th>Insumo</th>
                            <th>Cantidad</th>
                            <th>Unidad</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <div class="export-buttons">
                    <button onclick="exportarPDF('tablaInsumos', 'Reporte_Insumos.pdf')">Exportar a PDF</button>
                    <button onclick="exportarExcel('tablaInsumos', 'Reporte_Insumos.xlsx')">Exportar a Excel</button>
                </div>
            </div>

            <div class="report-section">
                <h3>Resumen de Uso de Insumos</h3>
                <table id="tablaUsoInsumos">
                    <thead>
                        <tr>
                            <th>Lote</th>
                            <th>Insumo</th>
                            <th>Cantidad</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <div class="export-buttons">
                    <button onclick="exportarPDF('tablaUsoInsumos', 'Reporte_Uso_Insumos.pdf')">Exportar a PDF</button>
                    <button onclick="exportarExcel('tablaUsoInsumos', 'Reporte_Uso_Insumos.xlsx')">Exportar a Excel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Inicializaci√≥n de datos en localStorage
        let lotes = JSON.parse(localStorage.getItem('lotes')) || [];
        let actividades = JSON.parse(localStorage.getItem('actividades')) || [];
        let insumos = JSON.parse(localStorage.getItem('insumos')) || [];
        let usoInsumos = JSON.parse(localStorage.getItem('usoInsumos')) || [];

        // Funci√≥n para mostrar/ocultar formularios
        function mostrarFormulario(id) {
            const formularios = document.querySelectorAll('.form-container');
            formularios.forEach(form => form.classList.remove('active'));
            document.getElementById(id).classList.add('active');

            const botones = document.querySelectorAll('.tab-button');
            botones.forEach(boton => boton.classList.remove('active'));
            document.querySelector(`[onclick="mostrarFormulario('${id}')"]`).classList.add('active');

            // Actualizar reportes si se muestra la pesta√±a de reportes
            if (id === 'reportes') {
                actualizarReportes();
            }
        }

        // Funciones para Lotes
        function guardarLote() {
            const numero = parseInt(document.getElementById('numeroLote').value);
            const variedad = document.getElementById('variedad').value;
            const area = parseFloat(document.getElementById('area').value);
            const surco = parseFloat(document.getElementById('surco').value);
            const plantas = parseFloat(document.getElementById('plantas').value);

            // Validar que el lote no est√© duplicado
            if (lotes.some(lote => lote.numero === numero)) {
                alert('¬°El n√∫mero de lote ya existe!');
                return;
            }

            // Calcular densidad y total de plantas
            const densidad = 10000 / (surco * plantas);
            const totalPlantas = Math.round(densidad * area);

            // Crear objeto lote
            const lote = {
                numero,
                variedad,
                area,
                surco,
                plantas,
                densidad,
                totalPlantas
            };

            // Guardar en el array y actualizar localStorage
            lotes.push(lote);
            localStorage.setItem('lotes', JSON.stringify(lotes));

            // Actualizar la tabla
            actualizarTablaLotes();
            actualizarSelectLotes();

            // Limpiar el formulario
            document.getElementById('loteForm').reset();
        }

        function actualizarTablaLotes() {
            const tbody = document.querySelector('#tablaLotes tbody');
            tbody.innerHTML = lotes.map((lote, index) => `
                <tr>
                    <td>${lote.numero}</td>
                    <td>${lote.variedad}</td>
                    <td>${lote.area}</td>
                    <td>${lote.densidad.toFixed(2)}</td>
                    <td>${lote.totalPlantas.toLocaleString()}</td>
                    <td>
                        <button onclick="verDetalleLote(${index})">Ver Detalle</button>
                        <button onclick="editarLote(${index})">Editar</button>
                        <button onclick="eliminarLote(${index})">Eliminar</button>
                    </td>
                </tr>
            `).join('');
        }

        function verDetalleLote(index) {
            const lote = lotes[index];
            const actividadesLote = actividades.filter(a => a.lote === lote.numero);
            const insumosLote = usoInsumos.filter(u => u.lote === lote.numero);

            let contenido = `
                <p><strong>N¬∞ Lote:</strong> ${lote.numero}</p>
                <p><strong>Variedad:</strong> ${lote.variedad}</p>
                <p><strong>√Årea (ha):</strong> ${lote.area}</p>
                <p><strong>Densidad (pl/ha):</strong> ${lote.densidad.toFixed(2)}</p>
                <p><strong>Total Plantas:</strong> ${lote.totalPlantas.toLocaleString()}</p>
                <h4>Actividades:</h4>
                <ul>
                    ${actividadesLote.map(a => `
                        <li>${a.labor} - ${a.jornales} jornales - $${a.valorTotal.toLocaleString()}</li>
                    `).join('')}
                </ul>
                <h4>Insumos Usados:</h4>
                <ul>
                    ${insumosLote.map(u => `
                        <li>${u.insumo} - ${u.cantidad} ${insumos.find(i => i.nombre === u.insumo)?.unidad}</li>
                    `).join('')}
                </ul>
            `;

            document.getElementById('detalleLoteContent').innerHTML = contenido;
            document.getElementById('detalleLote').style.display = 'block';
        }

        function editarLote(index) {
            const lote = lotes[index];
            document.getElementById('numeroLote').value = lote.numero;
            document.getElementById('variedad').value = lote.variedad;
            document.getElementById('area').value = lote.area;
            document.getElementById('surco').value = lote.surco;
            document.getElementById('plantas').value = lote.plantas;

            // Eliminar el lote actual para evitar duplicados
            lotes.splice(index, 1);
            localStorage.setItem('lotes', JSON.stringify(lotes));
            actualizarTablaLotes();
        }

        function eliminarLote(index) {
            lotes.splice(index, 1);
            localStorage.setItem('lotes', JSON.stringify(lotes));
            actualizarTablaLotes();
        }

        // Funciones para Actividades
        function guardarActividad() {
            const lote = parseInt(document.getElementById('loteActividad').value);
            const labor = document.getElementById('tipoLabor').value;
            const jornales = parseFloat(document.getElementById('jornales').value);
            const valorJornal = parseFloat(document.getElementById('valorJornal').value);

            const actividad = {
                lote,
                labor,
                jornales,
                valorTotal: jornales * valorJornal
            };

            actividades.push(actividad);
            localStorage.setItem('actividades', JSON.stringify(actividades));

            actualizarTablaActividades();
            document.getElementById('actividadForm').reset();
        }

        function actualizarTablaActividades() {
            const tbody = document.querySelector('#tablaActividades tbody');
            tbody.innerHTML = actividades.map((actividad, index) => `
                <tr>
                    <td>${actividad.lote}</td>
                    <td>${actividad.labor}</td>
                    <td>${actividad.jornales}</td>
                    <td>$${actividad.valorTotal.toLocaleString()}</td>
                    <td>
                        <button onclick="editarActividad(${index})">Editar</button>
                        <button onclick="eliminarActividad(${index})">Eliminar</button>
                    </td>
                </tr>
            `).join('');
        }

        function editarActividad(index) {
            const actividad = actividades[index];
            document.getElementById('loteActividad').value = actividad.lote;
            document.getElementById('tipoLabor').value = actividad.labor;
            document.getElementById('jornales').value = actividad.jornales;
            document.getElementById('valorJornal').value = actividad.valorTotal / actividad.jornales;

            // Eliminar la actividad actual para evitar duplicados
            actividades.splice(index, 1);
            localStorage.setItem('actividades', JSON.stringify(actividades));
            actualizarTablaActividades();
        }

        function eliminarActividad(index) {
            actividades.splice(index, 1);
            localStorage.setItem('actividades', JSON.stringify(actividades));
            actualizarTablaActividades();
        }

        // Funciones para Insumos
        function guardarInsumo() {
            const nombre = document.getElementById('nombreInsumo').value;
            const cantidad = parseFloat(document.getElementById('cantidadInsumo').value);
            const unidad = document.getElementById('unidadMedida').value;

            const insumo = {
                nombre,
                cantidad,
                unidad
            };

            insumos.push(insumo);
            localStorage.setItem('insumos', JSON.stringify(insumos));

            actualizarTablaInsumos();
            actualizarSelectInsumos();
            document.getElementById('insumoForm').reset();
        }

        function actualizarTablaInsumos() {
            const tbody = document.querySelector('#tablaInsumos tbody');
            tbody.innerHTML = insumos.map((insumo, index) => `
                <tr>
                    <td>${insumo.nombre}</td>
                    <td>${insumo.cantidad}</td>
                    <td>${insumo.unidad}</td>
                    <td>
                        <button onclick="editarInsumo(${index})">Editar</button>
                        <button onclick="eliminarInsumo(${index})">Eliminar</button>
                    </td>
                </tr>
            `).join('');
        }

        function editarInsumo(index) {
            const insumo = insumos[index];
            document.getElementById('nombreInsumo').value = insumo.nombre;
            document.getElementById('cantidadInsumo').value = insumo.cantidad;
            document.getElementById('unidadMedida').value = insumo.unidad;

            // Eliminar el insumo actual para evitar duplicados
            insumos.splice(index, 1);
            localStorage.setItem('insumos', JSON.stringify(insumos));
            actualizarTablaInsumos();
        }

        function eliminarInsumo(index) {
            insumos.splice(index, 1);
            localStorage.setItem('insumos', JSON.stringify(insumos));
            actualizarTablaInsumos();
        }

        // Funciones para Uso de Insumos
        function registrarUsoInsumo() {
            const lote = parseInt(document.getElementById('loteUsoInsumo').value);
            const insumoIndex = parseInt(document.getElementById('insumoDisponible').value);
            const cantidad = parseFloat(document.getElementById('cantidadUso').value);

            const insumo = insumos[insumoIndex];

            // Validar disponibilidad
            if (cantidad > insumo.cantidad) {
                alert(`No hay suficiente stock! Disponible: ${insumo.cantidad} ${insumo.unidad}`);
                return;
            }

            // Actualizar inventario
            insumo.cantidad -= cantidad;
            localStorage.setItem('insumos', JSON.stringify(insumos));

            // Registrar uso
            const uso = {
                lote,
                insumo: insumo.nombre,
                cantidad
            };

            usoInsumos.push(uso);
            localStorage.setItem('usoInsumos', JSON.stringify(usoInsumos));

            actualizarTablaUsoInsumos();
            actualizarSelectInsumos();
            document.getElementById('usoInsumoForm').reset();
        }

        function actualizarTablaUsoInsumos() {
            const tbody = document.querySelector('#tablaUsoInsumos tbody');
            tbody.innerHTML = usoInsumos.map((uso, index) => `
                <tr>
                    <td>${uso.lote}</td>
                    <td>${uso.insumo}</td>
                    <td>${uso.cantidad}</td>
                    <td>
                        <button onclick="editarUsoInsumo(${index})">Editar</button>
                        <button onclick="eliminarUsoInsumo(${index})">Eliminar</button>
                    </td>
                </tr>
            `).join('');
        }

        function editarUsoInsumo(index) {
            const uso = usoInsumos[index];
            document.getElementById('loteUsoInsumo').value = uso.lote;
            document.getElementById('insumoDisponible').value = insumos.findIndex(i => i.nombre === uso.insumo);
            document.getElementById('cantidadUso').value = uso.cantidad;

            // Eliminar el uso actual para evitar duplicados
            usoInsumos.splice(index, 1);
            localStorage.setItem('usoInsumos', JSON.stringify(usoInsumos));
            actualizarTablaUsoInsumos();
        }

        function eliminarUsoInsumo(index) {
            usoInsumos.splice(index, 1);
            localStorage.setItem('usoInsumos', JSON.stringify(usoInsumos));
            actualizarTablaUsoInsumos();
        }

        // Actualizar selects
        function actualizarSelectLotes() {
            const selectLotes = document.getElementById('loteActividad');
            const selectUsoInsumos = document.getElementById('loteUsoInsumo');

            selectLotes.innerHTML = lotes.map(lote => `
                <option value="${lote.numero}">Lote ${lote.numero}</option>
            `).join('');

            selectUsoInsumos.innerHTML = lotes.map(lote => `
                <option value="${lote.numero}">Lote ${lote.numero}</option>
            `).join('');
        }

        function actualizarSelectInsumos() {
            const selectInsumos = document.getElementById('insumoDisponible');

            selectInsumos.innerHTML = insumos
                .filter(insumo => insumo.cantidad > 0)
                .map((insumo, index) => `
                    <option value="${index}">${insumo.nombre} (${insumo.cantidad} ${insumo.unidad})</option>
                `).join('');
        }

        // Actualizar reportes
        function actualizarReportes() {
            actualizarTablaLotes();
            actualizarTablaActividades();
            actualizarTablaInsumos();
            actualizarTablaUsoInsumos();
        }

        // Exportar a PDF
        function exportarPDF(tableId, filename) {
            const table = document.getElementById(tableId);
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.autoTable({ html: table });
            doc.save(filename);
        }

        // Exportar a Excel
        function exportarExcel(tableId, filename) {
            const table = document.getElementById(tableId);
            const wb = XLSX.utils.table_to_book(table, { sheet: "Sheet1" });
            XLSX.writeFile(wb, filename);
        }

        // Cargar datos al iniciar
        actualizarSelectLotes();
        actualizarSelectInsumos();
        actualizarReportes();
    </script>
    <!-- Librer√≠as para exportar -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.24/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</body>
</html>
