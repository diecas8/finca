<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor Finca Cafetera</title>
    <style>
        /* Estilos básicos para responsividad */
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .section { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; }
        .form-group { margin-bottom: 10px; }
        .form-group label { display: block; margin-bottom: 5px; }
        .form-row { display: flex; gap: 10px; flex-wrap: wrap; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        @media (max-width: 768px) {
            .form-row { flex-direction: column; }
        }
    </style>
</head>
<body>
    <!-- Encabezado -->
    <div class="section">
        <h2>Información General de la Finca</h2>
        <div class="form-row">
            <div class="form-group">
                <label>Nombre de la finca: <input type="text" id="nombreFinca"></label>
            </div>
            <div class="form-group">
                <label>Área total (ha): <input type="number" id="areaTotal"></label>
            </div>
            <div class="form-group">
                <label>Área en café: <span id="areaCafe">0</span> ha</label>
            </div>
        </div>
    </div>

    <!-- Lotes -->
    <div class="section">
        <h2>Gestión de Lotes</h2>
        <form id="formLote" class="form-row">
            <input type="hidden" id="loteId">
            <div class="form-group">
                <label>Número de lote: <input type="text" id="numLote" required></label>
            </div>
            <div class="form-group">
                <label>Área (ha): <input type="number" id="areaLote" required></label>
            </div>
            <div class="form-group">
                <label>Variedad: <input type="text" id="variedad"></label>
            </div>
            <button type="submit">Guardar</button>
            <button type="button" onclick="cancelarEdicion()">Cancelar</button>
        </form>
        <table id="tablaLotes">
            <thead>
                <tr>
                    <th>Lote</th>
                    <th>Área (ha)</th>
                    <th>Variedad</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Bodega de Insumos -->
    <div class="section">
        <h2>Bodega de Insumos</h2>
        <table id="tablaInsumos">
            <thead>
                <tr>
                    <th>Insumo</th>
                    <th>Unidad</th>
                    <th>Cantidad</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Compra de Insumos -->
    <div class="section">
        <h2>Compra de Insumos</h2>
        <form id="formCompra" class="form-row">
            <div class="form-group">
                <label>Insumo: <input type="text" id="insumo" required></label>
            </div>
            <div class="form-group">
                <label>Unidad: <input type="text" id="unidad" required></label>
            </div>
            <div class="form-group">
                <label>Cantidad: <input type="number" id="cantidad" required></label>
            </div>
            <button type="submit">Registrar Compra</button>
        </form>
    </div>

<script>
// Sistema de almacenamiento
let lotes = JSON.parse(localStorage.getItem('lotes')) || [];
let insumos = JSON.parse(localStorage.getItem('insumos')) || [];

// Actualizar área en café
function actualizarAreaCafe() {
    const total = lotes.reduce((sum, lote) => sum + parseFloat(lote.area), 0);
    document.getElementById('areaCafe').textContent = total;
}

// Guardar en localStorage
function guardarDatos() {
    localStorage.setItem('lotes', JSON.stringify(lotes));
    localStorage.setItem('insumos', JSON.stringify(insumos));
    actualizarAreaCafe();
}

// CRUD Lotes
function renderLotes() {
    const tbody = document.querySelector('#tablaLotes tbody');
    tbody.innerHTML = '';
    
    lotes.forEach((lote, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${lote.numero}</td>
            <td>${lote.area}</td>
            <td>${lote.variedad}</td>
            <td>
                <button onclick="editarLote(${index})">Editar</button>
                <button onclick="eliminarLote(${index})">Eliminar</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

document.getElementById('formLote').addEventListener('submit', (e) => {
    e.preventDefault();
    const lote = {
        id: document.getElementById('loteId').value || Date.now(),
        numero: document.getElementById('numLote').value,
        area: parseFloat(document.getElementById('areaLote').value),
        variedad: document.getElementById('variedad').value
    };
    
    const index = lotes.findIndex(l => l.id == lote.id);
    if(index > -1) {
        lotes[index] = lote;
    } else {
        lotes.push(lote);
    }
    
    guardarDatos();
    renderLotes();
    e.target.reset();
});

function editarLote(index) {
    const lote = lotes[index];
    document.getElementById('loteId').value = lote.id;
    document.getElementById('numLote').value = lote.numero;
    document.getElementById('areaLote').value = lote.area;
    document.getElementById('variedad').value = lote.variedad;
}

function eliminarLote(index) {
    if(confirm('¿Eliminar este lote?')) {
        lotes.splice(index, 1);
        guardarDatos();
        renderLotes();
    }
}

// Gestión de Insumos
document.getElementById('formCompra').addEventListener('submit', (e) => {
    e.preventDefault();
    const insumo = {
        nombre: document.getElementById('insumo').value,
        unidad: document.getElementById('unidad').value,
        cantidad: parseFloat(document.getElementById('cantidad').value)
    };
    
    const existente = insumos.find(i => i.nombre === insumo.nombre);
    if(existente) {
        existente.cantidad += insumo.cantidad;
    } else {
        insumos.push(insumo);
    }
    
    guardarDatos();
    renderInsumos();
    e.target.reset();
});

function renderInsumos() {
    const tbody = document.querySelector('#tablaInsumos tbody');
    tbody.innerHTML = '';
    
    insumos.forEach(insumo => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${insumo.nombre}</td>
            <td>${insumo.unidad}</td>
            <td>${insumo.cantidad}</td>
        `;
        tbody.appendChild(tr);
    });
}

// Inicialización
function init() {
    renderLotes();
    renderInsumos();
    actualizarAreaCafe();
}

init();
</script>
</body>
</html>
