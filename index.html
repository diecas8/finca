<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión Cafetera</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* Estilos CSS personalizados */
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #2E8B57;
        }
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 10px 20px;
            margin: 0 5px;
            background: #2E8B57;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .tab-button:hover {
            background: #3CB371;
        }
        .tab-button.active {
            background: #3CB371;
        }
        .form-container {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .form-container.active {
            display: block;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #2E8B57;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #3CB371;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #2E8B57;
            color: white;
        }
        .report-section {
            margin-top: 40px;
        }
        .report-section h2 {
            color: #2E8B57;
            border-bottom: 2px solid #2E8B57;
            padding-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sistema de Gestión Cafetera</h1>

        <div class="tabs">
            <button class="tab-button active" onclick="mostrarFormulario('lotes')">Lotes</button>
            <button class="tab-button" onclick="mostrarFormulario('actividades')">Actividades</button>
            <button class="tab-button" onclick="mostrarFormulario('insumos')">Insumos</button>
            <button class="tab-button" onclick="mostrarFormulario('usoInsumos')">Uso de Insumos</button>
            <button class="tab-button" onclick="mostrarFormulario('reportes')">Reportes</button>
        </div>

        <div id="lotes" class="form-container active">
            <h2>Registro de Lotes</h2>
            <form id="loteForm">
                <div class="form-group">
                    <label>N° Lote:</label>
                    <input type="number" id="numeroLote" required>
                </div>
                <div class="form-group">
                    <label>Variedad:</label>
                    <select id="variedad" required>
                        <option value="">Seleccione</option>
                        <option>Castillo</option>
                        <option>Cenicafe</option>
                        <option>Colombia</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Área (ha):</label>
                    <input type="number" step="0.01" id="area" required>
                </div>
                <div class="form-group">
                    <label>Surco (m):</label>
                    <input type="number" step="0.01" id="surco" required>
                </div>
                <div class="form-group">
                    <label>Entre plantas (m):</label>
                    <input type="number" step="0.01" id="plantas" required>
                </div>
                <button type="button" onclick="guardarLote()">Guardar Lote</button>
            </form>
        </div>

        <div id="actividades" class="form-container">
            <h2>Registro de Actividades</h2>
            <form id="actividadForm">
                <div class="form-group">
                    <label>Lote:</label>
                    <select id="loteActividad" required></select>
                </div>
                <div class="form-group">
                    <label>Tipo de Labor:</label>
                    <select id="tipoLabor" required>
                        <option value="">Seleccione</option>
                        <option>Siembra</option>
                        <option>Fertilización</option>
                        <option>Poda</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>N° Jornales:</label>
                    <input type="number" id="jornales" step="0.5" required>
                </div>
                <div class="form-group">
                    <label>Valor por Jornal:</label>
                    <input type="number" id="valorJornal" step="1000" required>
                </div>
                <button type="button" onclick="guardarActividad()">Guardar Actividad</button>
            </form>
        </div>

        <div id="insumos" class="form-container">
            <h2>Registro de Insumos</h2>
            <form id="insumoForm">
                <div class="form-group">
                    <label>Insumo:</label>
                    <input type="text" id="nombreInsumo" required>
                </div>
                <div class="form-group">
                    <label>Cantidad:</label>
                    <input type="number" id="cantidadInsumo" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Unidad de Medida:</label>
                    <select id="unidadMedida" required>
                        <option>Kilo</option>
                        <option>Litro</option>
                        <option>Bulto</option>
                    </select>
                </div>
                <button type="button" onclick="guardarInsumo()">Guardar Insumo</button>
            </form>
        </div>

        <div id="usoInsumos" class="form-container">
            <h2>Uso de Insumos</h2>
            <form id="usoInsumoForm">
                <div class="form-group">
                    <label>Lote:</label>
                    <select id="loteUsoInsumo" required></select>
                </div>
                <div class="form-group">
                    <label>Insumo:</label>
                    <select id="insumoDisponible" required></select>
                </div>
                <div class="form-group">
                    <label>Cantidad a usar:</label>
                    <input type="number" id="cantidadUso" step="0.01" required>
                </div>
                <button type="button" onclick="
                    registrarUsoInsumo()">Registrar Uso</button>
            </form>
        </div>

        <div id="reportes" class="form-container">
            <h2>Reportes</h2>
            <div class="report-section">
                <h3>Resumen de Lotes</h3>
                <input type="text" id="buscarLote" placeholder="Buscar lote o variedad">
                <table>
                    <thead>
                        <tr>
                            <th>N° Lote</th>
                            <th>Variedad</th>
                            <th>Área (ha)</th>
                            <th>Densidad (pl/ha)</th>
                            <th>Total Plantas</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="reporteLotes"></tbody>
                </table>
            </div>

            <div class="report-section">
                <h3>Resumen de Actividades</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Lote</th>
                            <th>Actividad</th>
                            <th>Jornales</th>
                            <th>Valor Total</th>
                        </tr>
                    </thead>
                    <tbody id="reporteActividades"></tbody>
                </table>
            </div>

            <div class="report-section">
                <h3>Resumen de Insumos</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Insumo</th>
                            <th>Cantidad</th>
                            <th>Unidad</th>
                        </tr>
                    </thead>
                    <tbody id="reporteInsumos"></tbody>
                </table>
            </div>

            <div class="report-section">
                <h3>Resumen de Uso de Insumos</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Lote</th>
                            <th>Insumo</th>
                            <th>Cantidad</th>
                        </tr>
                    </thead>
                    <tbody id="reporteUsoInsumos"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        // Datos almacenados en localStorage
        let lotes = JSON.parse(localStorage.getItem('lotes')) || [];
        let actividades = JSON.parse(localStorage.getItem('actividades')) || [];
        let insumos = JSON.parse(localStorage.getItem('insumos')) || [];
        let usoInsumos = JSON.parse(localStorage.getItem('usoInsumos')) || [];

        // Función para mostrar/ocultar formularios
        function mostrarFormulario(id) {
            const formularios = document.querySelectorAll('.form-container');
            formularios.forEach(form => form.classList.remove('active'));
            document.getElementById(id).classList.add('active');

            const botones = document.querySelectorAll('.tab-button');
            botones.forEach(boton => boton.classList.remove('active'));
            document.querySelector(`[onclick="mostrarFormulario('${id}')"]`).classList.add('active');

            if (id === 'reportes') {
                actualizarReportes();
            }
        }

        // Funciones para Lotes
        function guardarLote() {
            const numero = parseInt(document.getElementById('numeroLote').value);
            const variedad = document.getElementById('variedad').value;
            const area = parseFloat(document.getElementById('area').value);
            const surco = parseFloat(document.getElementById('surco').value);
            const plantas = parseFloat(document.getElementById('plantas').value);

            if (isNaN(numero) || numero <= 0) {
                alert("Por favor, ingrese un número de lote válido.");
                return;
            }

            if (lotes.some(lote => lote.numero === numero)) {
                alert('¡El número de lote ya existe!');
                return;
            }

            const densidad = 10000 / (surco * plantas);
            const totalPlantas = Math.round(densidad * area);

            const lote = {
                numero,
                variedad,
                area,
                surco,
                plantas,
                densidad,
                totalPlantas
            };

            lotes.push(lote);
            localStorage.setItem('lotes', JSON.stringify(lotes));

            actualizarTablaLotes();
            actualizarSelectLotes();

            document.getElementById('loteForm').reset();
        }

        function actualizarTablaLotes(lotesMostrados = lotes) {
            const tbody = document.getElementById('reporteLotes');
            tbody.innerHTML = lotesMostrados.map(lote => `
                <tr>
                    <td><span class="math-inline">\{lote\.numero\}</td\>
<td\></span>{lote.variedad}</td>
                    <td><span class="math-inline">\{lote\.area\}</td\>
<td\></span>{lote.densidad.toFixed(2)}</td>
                    <td><span class="math-inline">\{lote\.totalPlantas\.toLocaleString\(\)\}</td\>
<td\>
<button onclick\="editarLote\(</span>{lote.numero})">Editar</button>
                        <button onclick="eliminarLote(${lote.numero})">Eliminar</button>
                    </td>
                </tr>
            `).join('');
        }

        function editarLote(numero) {
            const lote = lotes.find(lote => lote.numero === numero);
            if (lote) {
                document.getElementById('numeroLote').value = lote.numero;
                document.getElementById('variedad').value = lote.variedad;
                document.getElementById('area').value = lote.area;
                document.getElementById('surco').value = lote.surco;
                document.getElementById('plantas').value = lote.plantas;

                // Cambiar el botón "Guardar Lote" a "Actualizar Lote"
                const botonGuardar = document.querySelector('#loteForm button[type="button"]');
                botonGuardar.textContent = "Actualizar Lote";
                botonGuardar.onclick = () => actualizarLote(numero);
            }
        }

        function actualizarLote(numero) {
            const loteIndex = lotes.findIndex(lote => lote.numero === numero);
            if (loteIndex !== -1) {
                lotes[loteIndex].variedad = document.getElementById('variedad').value;
                lotes[loteIndex].area = parseFloat(document.getElementById('area').value);
                lotes[loteIndex].surco = parseFloat(document.getElementById('surco').value);
                lotes[loteIndex].plantas = parseFloat(document.getElementById('plantas').value);

                const densidad = 10000 / (lotes[loteIndex].surco * lotes[loteIndex].plantas);
                const totalPlantas = Math.round(densidad * lotes[loteIndex].area);
                lotes[loteIndex].densidad = densidad;
                lotes[loteIndex].totalPlantas = totalPlantas;

                localStorage.setItem('lotes', JSON.stringify(lotes));
                actualizarTablaLotes();
                document.getElementById('loteForm').reset();

                // Restablecer el botón "Guardar Lote"
                const botonGuardar = document.querySelector('#loteForm button[type="button"]');
                botonGuardar.textContent = "Guardar Lote";
                botonGuardar.onclick = guardarLote;
            }
        }

        function eliminarLote(numero) {
            if (confirm("¿Está seguro de eliminar este lote?")) {
                lotes = lotes.filter(lote => lote.numero !== numero);
                localStorage.setItem('lotes', JSON.stringify(lotes));
                actualizarTablaLotes();
                actualizarSelectLotes();
            }
        }

        // Funciones para Actividades
        function guardarActividad() {
            const lote = parseInt(document.getElementById('loteActividad').value);
            const labor = document.getElementById('tipoLabor').value;
            const jornales = parseFloat(document.getElementById('jornales').value);
            const valorJornal = parseFloat(document.getElementById('valorJornal').value);

            const actividad = {
                lote,
                labor,
                jornales,
                valorTotal: jornales * valorJornal
            };

            actividades.push(actividad);
            localStorage.setItem('actividades', JSON.stringify(actividades));

            actualizarTablaActividades();
            document.getElementById('actividadForm').reset();
        }

        function actualizarTablaActividades() {
            const tbody = document.getElementById('reporteActividades');
            tbody.innerHTML = actividades.map(actividad => `
                <tr>
                    <td><span class="math-inline">\{actividad\.lote\}</td\>
<td\></span>{actividad.labor}</td>
                    <td><span class="math-inline">\{actividad\.jornales\}</td\>
<td\></span>${
    ${actividad.valorTotal.toLocaleString()}</td>
                </tr>
            `).join('');
        }

        // Funciones para Insumos
        function guardarInsumo() {
            const nombre = document.getElementById('nombreInsumo').value;
            const cantidad = parseFloat(document.getElementById('cantidadInsumo').value);
            const unidad = document.getElementById('unidadMedida').value;

            const insumo = {
                nombre,
                cantidad,
                unidad
            };

            insumos.push(insumo);
            localStorage.setItem('insumos', JSON.stringify(insumos));

            actualizarTablaInsumos();
            actualizarSelectInsumos();
            document.getElementById('insumoForm').reset();
        }

        function actualizarTablaInsumos() {
            const tbody = document.getElementById('reporteInsumos');
            tbody.innerHTML = insumos.map(insumo => `
                <tr>
                    <td>${insumo.nombre}</td>
                    <td>${insumo.cantidad}</td>
                    <td>${insumo.unidad}</td>
                </tr>
            `).join('');
        }

        // Funciones para Uso de Insumos
        function registrarUsoInsumo() {
            const lote = parseInt(document.getElementById('loteUsoInsumo').value);
            const insumoIndex = parseInt(document.getElementById('insumoDisponible').value);
            const cantidad = parseFloat(document.getElementById('cantidadUso').value);

            const insumo = insumos[insumoIndex];

            if (cantidad > insumo.cantidad) {
                alert(`No hay suficiente stock! Disponible: ${insumo.cantidad} ${insumo.unidad}`);
                return;
            }

            insumo.cantidad -= cantidad;
            localStorage.setItem('insumos', JSON.stringify(insumos));

            const uso = {
                lote,
                insumo: insumo.nombre,
                cantidad
            };

            usoInsumos.push(uso);
            localStorage.setItem('usoInsumos', JSON.stringify(usoInsumos));

            actualizarTablaUsoInsumos();
            actualizarSelectInsumos();
            document.getElementById('usoInsumoForm').reset();
        }

        function actualizarTablaUsoInsumos() {
            const tbody = document.getElementById('reporteUsoInsumos');
            tbody.innerHTML = usoInsumos.map(uso => `
                <tr>
                    <td>${uso.lote}</td>
                    <td>${uso.insumo}</td>
                    <td>${uso.cantidad}</td>
                </tr>
            `).join('');
        }

        // Actualizar selects
        function actualizarSelectLotes() {
            const selectLotes = document.getElementById('loteActividad');
            const selectUsoInsumos = document.getElementById('loteUsoInsumo');

            selectLotes.innerHTML = lotes.map(lote => `
                <option value="${lote.numero}">Lote ${lote.numero}</option>
            `).join('');

            selectUsoInsumos.innerHTML = lotes.map(lote => `
                <option value="${lote.numero}">Lote ${lote.numero}</option>
            `).join('');
        }

        function actualizarSelectInsumos() {
            const selectInsumos = document.getElementById('insumoDisponible');

            selectInsumos.innerHTML = insumos
                .filter(insumo => insumo.cantidad > 0)
                .map((insumo, index) => `
                    <option value="${index}">${insumo.nombre} (${insumo.cantidad} ${insumo.unidad})</option>
                `).join('');
        }

        // Actualizar reportes
        function actualizarReportes() {
            actualizarTablaLotes();
            actualizarTablaActividades();
            actualizarTablaInsumos();
            actualizarTablaUsoInsumos();
        }

        // Cargar datos al iniciar
        actualizarSelectLotes();
        actualizarSelectInsumos();
        actualizarReportes();

        // Búsqueda en la tabla de lotes
        const inputBusqueda = document.getElementById("buscarLote");
        inputBusqueda.addEventListener("keyup", function() {
            const filtro = inputBusqueda.value.toLowerCase();
            const lotesFiltrados = lotes.filter(lote => {
                return lote.numero.toString().includes(filtro) ||
                       lote.variedad.toLowerCase().includes(filtro);
            });
            actualizarTablaLotes(lotesFiltrados);
        });
    </script>
</body>
</html>
