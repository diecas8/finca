<!-- Esto es como tu cuaderno mágico ✨ -->
<!DOCTYPE html>
<html>
<head>
    <title>Finca Café Mágico 🌱</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .seccion { background: #e0f7fa; padding: 20px; margin: 10px; border-radius: 10px; }
        input, button { margin: 5px; padding: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #4CAF50; padding: 8px; }
    </style>
<head>
    <title>Finca Café Mágico 🌱</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .seccion { background: #e0f7fa; padding: 20px; margin: 10px; border-radius: 10px; }
        
        /* ▼▼▼ NUEVO CÓDIGO PEGADO AQUÍ ▼▼▼ */
        .columnas-magicas {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        label {
            display: block;
            margin: 10px 0 5px;
            color: #2e7d32;
            font-weight: bold;
        }
        /* ▲▲▲ FIN DEL NUEVO CÓDIGO ▲▲▲ */
        
        input, button { margin: 5px; padding: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    </style>
</head>

<!-- ▼▼▼ PEGA ESTE BLOQUE AL PRINCIPIO ▼▼▼ -->
<!-- ▼▼▼ PEGA ESTE BLOQUE AL PRINCIPIO ▼▼▼ -->
<div class="seccion">
    <h2>📋 Información de la Finca</h2>
    <form onsubmit="guardarFinca(event)">
        <div class="columnas-magicas">
            <div>
                <label>Nombre de la finca:</label>
                <input type="text" id="nombreFinca" required>
                
                <label>Área total (hectáreas):</label>
                <input type="number" step="0.01" id="areaTotal" required>
                
                <label>Propietario:</label>
                <input type="text" id="propietario" required>
            </div>
            
            <div>
                <label>Vereda:</label>
                <input type="text" id="vereda" required>
                
                <label>Municipio:</label>
                <input type="text" id="municipio" required>
                
                <label>Área en café (auto):</label>
                <input type="number" step="0.01" id="areaCafe" readonly>
            </div>
        </div>
        <button type="submit">💾 Guardar</button>
    </form>
</div>
<!-- ▲▲▲ HASTA AQUÍ ▲▲▲ --><!-- ▲▲▲ HASTA AQUÍ ▲▲▲ -->
<!-- TIENDA DE JUGUETES: Insumos -->
<div class="seccion">
    <h2>🛒 Compras de Insumos</h2>
    <input type="date" id="fechaCompra">
    <input type="text" id="insumo" placeholder="Nombre del insumo">
    <input type="number" step="0.01" id="cantidadCompra" placeholder="Cantidad">
    <button onclick="comprarInsumo()">🛒 Agregar</button>
</div>

<!-- ▼▼▼ PEGA ESTE BLOQUE EN VEZ DE LA VIEJA BODEGA ▼▼▼ -->
<div class="seccion">
    <h2>📦 Bodega de Insumos (Mejorada)</h2>
    <table id="tablaBodega">
        <tr>
            <th>Insumo</th>
            <th>Unidad</th>
            <th>En Stock</th>
            <th>Última Compra</th>
            <th>Total Usado</th>
            <th>Disponible</th>
        </tr>
    </table>
</div>
<!-- ▲▲▲ HASTA AQUÍ ▲▲▲ -->

<!-- LOTES DE JUEGO -->
<div class="seccion">
    <h2>🌱 Lotes de Café</h2>
    <input type="text" id="numLote" placeholder="Número de lote">
    <input type="number" step="0.01" id="areaLote" placeholder="Área (ha)" oninput="calcularPlantas()">
    <input type="number" step="0.01" id="distanciaCalles" placeholder="Distancia calles (m)" oninput="calcularPlantas()">
    <input type="number" step="0.01" id="distanciaPlantas" placeholder="Distancia plantas (m)" oninput="calcularPlantas()">
    <input type="text" id="densidad" placeholder="Densidad" readonly>
    <input type="text" id="numPlantas" placeholder="Plantas totales" readonly>
    <button onclick="guardarLote()">💾 Guardar</button>
</div>
<!-- Agrega esto en el BODY después de la sección de Lotes -->
<div class="seccion">
    <h2>👷 Actividades en Lotes</h2>
    <select id="loteActividad" onchange="cargarInsumos()">
        <option>Elige un lote</option>
    </select>
    <input type="date" id="fechaActividad">
    <input type="text" id="nombreActividad" placeholder="Nombre actividad">
    <input type="number" id="jornales" placeholder="Número de jornales" oninput="calcularTotal()">
    <input type="number" step="0.01" id="valorJornal" placeholder="Valor por jornal" oninput="calcularTotal()">
    <input type="number" id="totalActividad" placeholder="Total" readonly>
    <button onclick="guardarActividad()">💾 Guardar</button>
    
    <table id="tablaActividades">
        <tr><th>Lote</th><th>Actividad</th><th>Total</th><th>Acciones</th></tr>
    </table>
</div>

<div class="seccion">
    <h2>📦 Usar Insumos en Lotes</h2>
    <select id="loteUso">
        <option>Elige un lote</option>
    </select>
    <select id="insumoUso">
        <option>Elige insumo</option>
    </select>
    <input type="number" step="0.01" id="cantidadUso" placeholder="Cantidad a usar">
    <button onclick="usarInsumo()">➖ Usar</button>
</div>

<script>
// 🧙♂️ VARIABLES MÁGICAS
let actividades = [];
let usandoInsumoEditIndex = -1;

// 🎠 FUNCIONES NUEVAS
function calcularTotal() {
    let jornales = parseFloat(document.getElementById('jornales').value) || 0;
    let valor = parseFloat(document.getElementById('valorJornal').value) || 0;
    document.getElementById('totalActividad').value = (jornales * valor).toFixed(2);
}

function guardarActividad() {
    let nuevaActividad = {
        lote: document.getElementById('loteActividad').value,
        fecha: document.getElementById('fechaActividad').value,
        nombre: document.getElementById('nombreActividad').value,
        jornales: document.getElementById('jornales').value,
        valor: document.getElementById('valorJornal').value,
        total: document.getElementById('totalActividad').value
    };
    
    if(usandoInsumoEditIndex > -1) {
        actividades[usandoInsumoEditIndex] = nuevaActividad; // ✏️ Editar
        usandoInsumoEditIndex = -1;
    } else {
        actividades.push(nuevaActividad); // 🆕 Nueva
    }
    
    actualizarActividades();
}

function actualizarActividades() {
    let tabla = document.getElementById('tablaActividades');
    tabla.innerHTML = '<tr><th>Lote</th><th>Actividad</th><th>Total</th><th>Acciones</th></tr>';
    
    actividades.forEach((act, index) => {
        tabla.innerHTML += `
            <tr>
                <td>${act.lote}</td>
                <td>${act.nombre}</td>
                <td>$${act.total}</td>
                <td>
                    <button onclick="editarActividad(${index})">✏️</button>
                    <button onclick="eliminarActividad(${index})">🗑️</button>
                </td>
            </tr>`;
    });
}

function editarActividad(index) {
    let act = actividades[index];
    document.getElementById('loteActividad').value = act.lote;
    document.getElementById('fechaActividad').value = act.fecha;
    document.getElementById('nombreActividad').value = act.nombre;
    document.getElementById('jornales').value = act.jornales;
    document.getElementById('valorJornal').value = act.valor;
    usandoInsumoEditIndex = index;
}

function eliminarActividad(index) {
    if(confirm("¿Borrar esta actividad?")) {
        actividades.splice(index, 1);
        actualizarActividades();
    }
}

// 🧪 FUNCIÓN PARA USAR INSUMOS
function usarInsumo() {
    let insumo = document.getElementById('insumoUso').value;
    let cantidad = parseFloat(document.getElementById('cantidadUso').value);
    
    if(bodega[insumo] >= cantidad) {
        bodega[insumo] -= cantidad;
        alert(`✅ Usaste ${cantidad} de ${insumo}`);
        actualizarBodega();
    } else {
        alert("🚨 ¡No hay suficiente en bodega!");
    }
}

// 🎡 ACTUALIZAR LISTAS MÁGICAS
function cargarInsumos() {
    let select = document.getElementById('insumoUso');
    select.innerHTML = '<option>Elige insumo</option>';
    
    for(let insumo in bodega) {
        select.innerHTML += `<option>${insumo}</option>`;
    }
}

// 🏁 INICIAR EL JUEGO
window.onload = function() {
    actualizarBodega();
    cargarInsumos();
};
<script>
// 🎉 NUESTRAS VARIABLES MÁGICAS
let bodega = {};
let lotes = [];

// 🛒 FUNCIÓN PARA COMPRAR JUGUETES (INSUMOS)
function comprarInsumo() {
    const insumo = document.getElementById('insumo').value;
    const cantidad = parseFloat(document.getElementById('cantidadCompra').value);
    
    if(bodega[insumo]) {
        bodega[insumo] += cantidad; // Si ya tenemos, sumamos
    } else {
        bodega[insumo] = cantidad;  // Si no, creamos nuevo
    }
    
    actualizarBodega();
}

// 🧹 FUNCIÓN MEJORADA PARA BODEGA
function actualizarBodega() {
    const tabla = document.getElementById('tablaBodega');
    tabla.innerHTML = `
        <tr>
            <th>Insumo</th>
            <th>Unidad</th>
            <th>En Stock</th>
            <th>Última Compra</th>
            <th>Total Usado</th>
            <th>Disponible</th>
        </tr>`;
    
    for(let insumo in bodega) {
        tabla.innerHTML += `
            <tr>
                <td>${insumo}</td>
                <td>${bodega[insumo].unidad}</td>
                <td>${bodega[insumo].existencia.toFixed(2)}</td>
                <td>${bodega[insumo].ultimaCompra || 'N/A'}</td>
                <td>${(bodega[insumo].usado || 0).toFixed(2)}</td>
                <td>${(bodega[insumo].existencia - (bodega[insumo].usado || 0)).toFixed(2)}</td>
            </tr>`;
    }
}

// 🛒 MODIFICAR LA FUNCIÓN DE COMPRA (para guardar fecha)
function comprarInsumo() {
    const insumo = document.getElementById('insumo').value;
    const cantidad = parseFloat(document.getElementById('cantidadCompra').value);
    
    if(!bodega[insumo]) {
        bodega[insumo] = {
            existencia: 0,
            unidad: 'kg', // ◄ Puedes cambiar la unidad si quieres
            usado: 0
        };
    }
    
    bodega[insumo].existencia += cantidad;
    bodega[insumo].ultimaCompra = new Date().toLocaleDateString(); // 📅 Fecha actual
    
    actualizarBodega();
}

// ➖ MODIFICAR LA FUNCIÓN DE USAR INSUMOS (para restar)
function usarInsumo() {
    const insumo = document.getElementById('insumoUso').value;
    const cantidad = parseFloat(document.getElementById('cantidadUso').value);
    
    if(bodega[insumo] && bodega[insumo].existencia >= cantidad) {
        bodega[insumo].existencia -= cantidad;
        bodega[insumo].usado = (bodega[insumo].usado || 0) + cantidad;
        actualizarBodega();
        alert(`✅ Usaste ${cantidad}${bodega[insumo].unidad} de ${insumo}`);
    } else {
        alert("🚨 ¡No hay suficiente en bodega!");
    }
}
// 🌟 FUNCIÓN MEJORADA PARA LOTES
function calcularPlantas() {
    let area = parseFloat(document.getElementById('areaLote').value) || 0;
    let calles = parseFloat(document.getElementById('distanciaCalles').value) || 0;
    let plantas = parseFloat(document.getElementById('distanciaPlantas').value) || 0;
    
    if(calles > 0 && plantas > 0) {
        let densidad = 10000 / (calles * plantas); // ¡Mágia matemática!
        document.getElementById('densidad').value = densidad.toFixed(2);
        document.getElementById('numPlantas').value = (area * densidad).toFixed(0);
    }
}

// 🚀 ACTUALIZAR ÁREA TOTAL DE CAFÉ
function actualizarAreaTotal() {
    let total = lotes.reduce((sum, lote) => sum + parseFloat(lote.area), 0);
    document.getElementById('totalCafe').value = total.toFixed(2);
}

// 🎉 MODIFICAR LA FUNCIÓN GUARDAR LOTE
function guardarLote() {
    // ... (código anterior) ...
    actualizarAreaTotal(); // ◄¡Nueva línea mágica!
}
    const nuevoLote = {
        numero: document.getElementById('numLote').value,
        area: document.getElementById('areaLote').value,
        densidad: document.getElementById('densidad').value,
        plantas: document.getElementById('numPlantas').value
    };
    
    lotes.push(nuevoLote);
    alert('✅ ¡Lote guardado!');
}
</script>

</body>
</html>
