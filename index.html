<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión Cafetera</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #2E8B57;
        }
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 10px 20px;
            margin: 0 5px;
            background: #2E8B57;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .tab-button:hover {
            background: #3CB371;
        }
        .tab-button.active {
            background: #3CB371;
        }
        .form-container {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .form-container.active {
            display: block;
        }
        .form-group {
            margin-bottom: 15px;
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 10px;
            align-items: center;
        }
        input, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #2E8B57;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #3CB371;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #2E8B57;
            color: white;
        }
        .total-box {
            margin: 15px 0;
            padding: 10px;
            background: #e9ffe9;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🌱 Sistema de Gestión Cafetera</h1>

        <!-- Pestañas -->
        <div class="tabs">
            <button class="tab-button active" onclick="mostrarFormulario('lotes')">🌱 Lotes</button>
            <button class="tab-button" onclick="mostrarFormulario('actividades')">👷 Actividades</button>
            <button class="tab-button" onclick="mostrarFormulario('insumos')">🛒 Insumos</button>
            <button class="tab-button" onclick="mostrarFormulario('reportes')">📊 Reportes</button>
        </div>

        <!-- Formulario de Lotes -->
        <div id="lotes" class="form-container active">
            <h2>Registro de Lotes</h2>
            <form id="loteForm">
                <div class="form-group">
                    <label>N° Lote:</label>
                    <input type="number" id="numeroLote" required>
                </div>
                <div class="form-group">
                    <label>Variedad:</label>
                    <select id="variedad" required>
                        <option value="">Seleccione</option>
                        <option>Castillo</option>
                        <option>Cenicafe</option>
                        <option>Colombia</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Área (ha):</label>
                    <input type="number" step="0.01" id="area" required>
                </div>
                <div class="form-group">
                    <label>Surco (m):</label>
                    <input type="number" step="0.01" id="surco" required>
                </div>
                <div class="form-group">
                    <label>Entre plantas (m):</label>
                    <input type="number" step="0.01" id="plantas" required>
                </div>
                <button type="button" onclick="guardarLote()">Guardar Lote</button>
            </form>
        </div>

        <!-- Formulario de Actividades -->
        <div id="actividades" class="form-container">
            <h2>👷 Registro de Actividades</h2>
            <form id="actividadForm">
                <div class="form-group">
                    <label>Lote:</label>
                    <select id="loteActividad" required></select>
                </div>
                <div class="form-group">
                    <label>Tipo de Labor:</label>
                    <select id="tipoLabor" required>
                        <option value="">Seleccione</option>
                        <option>Siembra</option>
                        <option>Fertilización</option>
                        <option>Poda</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>N° Jornales:</label>
                    <input type="number" id="jornales" step="0.5" required>
                </div>
                <div class="form-group">
                    <label>Valor por Jornal:</label>
                    <input type="number" id="valorJornal" step="1000" required>
                </div>
                <div class="total-box">
                    💰 Valor Total: $<span id="valorTotalActividad">0</span>
                </div>
                <button type="button" onclick="guardarActividad()">Guardar Actividad</button>
            </form>
        </div>

        <!-- Formulario de Insumos -->
        <div id="insumos" class="form-container">
            <h2>🛒 Registro de Insumos</h2>
            <form id="insumoForm">
                <div class="form-group">
                    <label>Fecha de Compra:</label>
                    <input type="date" id="fechaCompra" required>
                </div>
                <div class="form-group">
                    <label>Insumo:</label>
                    <input type="text" id="nombreInsumo" required>
                </div>
                <div class="form-group">
                    <label>Unidad:</label>
                    <select id="unidadMedida" required>
                        <option>Kilo</option>
                        <option>Litro</option>
                        <option>Bulto</option>
                        <option>Unidad</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Cantidad:</label>
                    <input type="number" id="cantidadInsumo" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Valor Unitario:</label>
                    <input type="number" id="valorUnitario" step="100" required>
                </div>
                <div class="total-box">
                    💰 Valor Total: $<span id="valorTotalInsumo">0</span>
                </div>
                <button type="button" onclick="guardarInsumo()">Guardar Insumo</button>
            </form>
        </div>

        <!-- Reportes -->
        <div id="reportes" class="form-container">
            <h2>📊 Reportes</h2>
            
            <div class="report-section">
                <h3>Lotes Registrados</h3>
                <table id="tablaLotes">
                    <thead>
                        <tr>
                            <th>N° Lote</th>
                            <th>Variedad</th>
                            <th>Área</th>
                            <th>Densidad</th>
                            <th>Plantas</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div class="report-section">
                <h3>Actividades Registradas</h3>
                <table id="tablaActividades">
                    <thead>
                        <tr>
                            <th>Lote</th>
                            <th>Actividad</th>
                            <th>Jornales</th>
                            <th>Valor Total</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div class="report-section">
                <h3>Insumos Registrados</h3>
                <table id="tablaInsumos">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Insumo</th>
                            <th>Unidad</th>
                            <th>Cantidad</th>
                            <th>V. Unitario</th>
                            <th>V. Total</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Datos almacenados en localStorage
        let lotes = JSON.parse(localStorage.getItem('lotes')) || [];
        let actividades = JSON.parse(localStorage.getItem('actividades')) || [];
        let insumos = JSON.parse(localStorage.getItem('insumos')) || [];

        // Función para mostrar formularios
        function mostrarFormulario(id) {
            document.querySelectorAll('.form-container').forEach(f => f.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.querySelector(`[onclick="mostrarFormulario('${id}')"]`).classList.add('active');
        }

        // Funciones para Lotes
        function guardarLote() {
            const lote = {
                numero: parseInt(document.getElementById('numeroLote').value),
                variedad: document.getElementById('variedad').value,
                area: parseFloat(document.getElementById('area').value),
                surco: parseFloat(document.getElementById('surco').value),
                plantas: parseFloat(document.getElementById('plantas').value),
                densidad: 10000 / (parseFloat(document.getElementById('surco').value) * parseFloat(document.getElementById('plantas').value)),
                totalPlantas: Math.round((10000 / (parseFloat(document.getElementById('surco').value) * parseFloat(document.getElementById('plantas').value))) * parseFloat(document.getElementById('area').value))
            };

            if (lotes.some(l => l.numero === lote.numero)) {
                alert("¡El número de lote ya existe!");
                return;
            }

            lotes.push(lote);
            localStorage.setItem('lotes', JSON.stringify(lotes));
            actualizarSelectLotes();
            actualizarReportes();
            document.getElementById('loteForm').reset();
        }

        function actualizarSelectLotes() {
            const select = document.getElementById('loteActividad');
            select.innerHTML = lotes.map(l => `<option value="${l.numero}">Lote ${l.numero}</option>`).join('');
        }

        // Funciones para Actividades
        function guardarActividad() {
            const actividad = {
                lote: parseInt(document.getElementById('loteActividad').value),
                labor: document.getElementById('tipoLabor').value,
                jornales: parseFloat(document.getElementById('jornales').value),
                valorTotal: parseFloat(document.getElementById('valorJornal').value) * parseFloat(document.getElementById('jornales').value)
            };

            actividades.push(actividad);
            localStorage.setItem('actividades', JSON.stringify(actividades));
            actualizarReportes();
            document.getElementById('actividadForm').reset();
        }

        // Funciones para Insumos
        function guardarInsumo() {
            const insumo = {
                fecha: document.getElementById('fechaCompra').value,
                nombre: document.getElementById('nombreInsumo').value,
                unidad: document.getElementById('unidadMedida').value,
                cantidad: parseFloat(document.getElementById('cantidadInsumo').value),
                valorUnitario: parseFloat(document.getElementById('valorUnitario').value),
                valorTotal: parseFloat(document.getElementById('cantidadInsumo').value) * parseFloat(document.getElementById('valorUnitario').value)
            };

            insumos.push(insumo);
            localStorage.setItem('insumos', JSON.stringify(insumos));
            actualizarReportes();
            document.getElementById('insumoForm').reset();
        }

        // Actualizar reportes
        function actualizarReportes() {
            // Actualizar tabla de lotes
            document.querySelector('#tablaLotes tbody').innerHTML = lotes.map(lote => `
                <tr>
                    <td>${lote.numero}</td>
                    <td>${lote.variedad}</td>
                    <td>${lote.area} ha</td>
                    <td>${lote.densidad.toFixed(2)}</td>
                    <td>${lote.totalPlantas}</td>
                    <td><button onclick="eliminarLote(${lote.numero})">Eliminar</button></td>
                </tr>
            `).join('');

            // Actualizar tabla de actividades
            document.querySelector('#tablaActividades tbody').innerHTML = actividades.map(actividad => `
                <tr>
                    <td>${actividad.lote}</td>
                    <td>${actividad.labor}</td>
                    <td>${actividad.jornales}</td>
                    <td>$${actividad.valorTotal.toLocaleString()}</td>
                </tr>
            `).join('');

            // Actualizar tabla de insumos
            document.querySelector('#tablaInsumos tbody').innerHTML = insumos.map(insumo => `
                <tr>
                    <td>${insumo.fecha}</td>
                    <td>${insumo.nombre}</td>
                    <td>${insumo.unidad}</td>
                    <td>${insumo.cantidad}</td>
                    <td>$${insumo.valorUnitario.toLocaleString()}</td>
                    <td>$${insumo.valorTotal.toLocaleString()}</td>
                </tr>
            `).join('');
        }

        // Eliminar lotes
        function eliminarLote(numeroLote) {
            lotes = lotes.filter(l => l.numero !== numeroLote);
            actividades = actividades.filter(a => a.lote !== numeroLote);
            localStorage.setItem('lotes', JSON.stringify(lotes));
            localStorage.setItem('actividades', JSON.stringify(actividades));
            actualizarReportes();
        }

        // Cálculos en tiempo real
        document.getElementById('jornales').addEventListener('input', actualizarTotalActividad);
        document.getElementById('valorJornal').addEventListener('input', actualizarTotalActividad);
        document.getElementById('cantidadInsumo').addEventListener('input', actualizarTotalInsumo);
        document.getElementById('valorUnitario').addEventListener('input', actualizarTotalInsumo);

        function actualizarTotalActividad() {
            const jornales = parseFloat(document.getElementById('jornales').value) || 0;
            const valor = parseFloat(document.getElementById('valorJornal').value) || 0;
            document.getElementById('valorTotalActividad').textContent = (jornales * valor).toLocaleString();
        }

        function actualizarTotalInsumo() {
            const cantidad = parseFloat(document.getElementById('cantidadInsumo').value) || 0;
            const valor = parseFloat(document.getElementById('valorUnitario').value) || 0;
            document.getElementById('valorTotalInsumo').textContent = (cantidad * valor).toLocaleString();
        }

        // Inicialización
        actualizarSelectLotes();
        actualizarReportes();
    </script>
</body>
</html>
