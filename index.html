<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema Cafetero Integral</title>
    <style>
        /* Estilos existentes */
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 20px auto; padding: 20px; }
        .form-container { background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .form-group { margin-bottom: 10px; }
        input, select { width: 200px; padding: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #4CAF50; color: white; }
        button { background-color: #4CAF50; color: white; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #45a049; }
        
        /* Nuevos estilos */
        .section-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .total-box { background: #e8f5e9; padding: 10px; margin-top: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <!-- Sección original de Lotes -->
    <div class="form-container">
        <h2>Registro de Lotes</h2>
        <!-- Mantenemos el formulario original sin cambios -->
        <!-- ... [El formulario original completo aquí] ... -->
    </div>

    <!-- Nuevo formulario de Mano de Obra -->
    <div class="form-container">
        <h2>Registro Mano de Obra</h2>
        <form id="manoObraForm">
            <div class="form-group">
                <label>Lote:</label>
                <select id="loteManoObra" required>
                    <option value="">Seleccionar Lote</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Tipo de Labor:</label>
                <select id="tipoLaborMano" required>
                    <option value="">Seleccionar</option>
                    <option>Adecuacion de terreno</option>
                    <option>Trazado</option>
                    <option>Ahoyado</option>
                    <option>Siembra</option>
                    <option>Resiembra</option>
                    <option>Fertilizacion</option>
                    <option>Control de arvenses</option>
                    <option>Control de plagas</option>
                    <option>Plateo</option>
                    <option>Encalado</option>
                    <option>Zoqueo</option>
                    <option>Recoleccion</option>
                    <option>Otro</option>
                </select>
            </div>

            <div class="form-group">
                <label>N° Jornales:</label>
                <input type="number" id="jornales" step="0.5" required>
            </div>

            <div class="form-group">
                <label>Tipo Jornal:</label>
                <select id="tipoJornal" required>
                    <option>Al día</option>
                    <option>Guadaña</option>
                </select>
            </div>

            <div class="form-group">
                <label>Valor Jornal:</label>
                <input type="number" id="valorJornal" step="1000" required>
            </div>

            <div class="total-box">
                Valor Total: $<span id="valorTotal">0</span>
            </div>

            <button type="button" onclick="guardarManoObra()">Guardar</button>
            <button type="button" onclick="cancelarEdicionMO()" style="background-color: #f44336; display: none;" id="cancelMO">Cancelar</button>
        </form>
    </div>

    <!-- Tabla de Mano de Obra -->
    <div class="form-container">
        <h3>Registros de Mano de Obra</h3>
        <table>
            <thead>
                <tr>
                    <th>Lote</th>
                    <th>Labor</th>
                    <th>Jornales</th>
                    <th>Tipo</th>
                    <th>Valor Unitario</th>
                    <th>Total</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="registrosMO"></tbody>
        </table>
    </div>

    <script>
        // Datos existentes
        let lotes = [];
        let manoObra = [];
        let editandoMO = false;
        let indiceEdicionMO = null;

        // Actualizar selector de lotes
        function actualizarLotesSelector() {
            const selector = document.getElementById('loteManoObra');
            selector.innerHTML = '<option value="">Seleccionar Lote</option>';
            lotes.forEach(lote => {
                selector.innerHTML += `<option value="${lote.numero}">Lote ${lote.numero}</option>`;
            });
        }

        // Calcular total
        function calcularTotal() {
            const jornales = parseFloat(document.getElementById('jornales').value) || 0;
            const valor = parseFloat(document.getElementById('valorJornal').value) || 0;
            document.getElementById('valorTotal').textContent = (jornales * valor).toLocaleString();
        }

        // Guardar mano de obra
        function guardarManoObra() {
            const registro = {
                lote: document.getElementById('loteManoObra').value,
                labor: document.getElementById('tipoLaborMano').value,
                jornales: parseFloat(document.getElementById('jornales').value),
                tipo: document.getElementById('tipoJornal').value,
                valor: parseFloat(document.getElementById('valorJornal').value),
                total: parseFloat(document.getElementById('valorTotal').textContent.replace(/,/g, ''))
            };

            if (editandoMO) {
                manoObra[indiceEdicionMO] = registro;
                editandoMO = false;
                indiceEdicionMO = null;
                document.getElementById('cancelMO').style.display = 'none';
            } else {
                manoObra.push(registro);
            }

            actualizarTablaMO();
            document.getElementById('manoObraForm').reset();
            document.getElementById('valorTotal').textContent = '0';
        }

        // Editar registro
        function editarMO(index) {
            const registro = manoObra[index];
            document.getElementById('loteManoObra').value = registro.lote;
            document.getElementById('tipoLaborMano').value = registro.labor;
            document.getElementById('jornales').value = registro.jornales;
            document.getElementById('tipoJornal').value = registro.tipo;
            document.getElementById('valorJornal').value = registro.valor;
            
            editandoMO = true;
            indiceEdicionMO = index;
            document.getElementById('cancelMO').style.display = 'inline-block';
            calcularTotal();
        }

        // Eliminar registro
        function eliminarMO(index) {
            manoObra.splice(index, 1);
            actualizarTablaMO();
        }

        // Actualizar tabla
        function actualizarTablaMO() {
            const tbody = document.getElementById('registrosMO');
            tbody.innerHTML = manoObra.map((registro, index) => `
                <tr>
                    <td>${registro.lote}</td>
                    <td>${registro.labor}</td>
                    <td>${registro.jornales}</td>
                    <td>${registro.tipo}</td>
                    <td>$${registro.valor.toLocaleString()}</td>
                    <td>$${registro.total.toLocaleString()}</td>
                    <td>
                        <button onclick="editarMO(${index})">Editar</button>
                        <button onclick="eliminarMO(${index})" style="background-color: #f44336;">Eliminar</button>
                    </td>
                </tr>
            `).join('');
        }

        // Event listeners para cálculos en tiempo real
        document.getElementById('jornales').addEventListener('input', calcularTotal);
        document.getElementById('valorJornal').addEventListener('input', calcularTotal);

        // Función de cancelar edición
        function cancelarEdicionMO() {
            editandoMO = false;
            indiceEdicionMO = null;
            document.getElementById('manoObraForm').reset();
            document.getElementById('cancelMO').style.display = 'none';
            document.getElementById('valorTotal').textContent = '0';
        }

        // Actualizar selector de lotes periódicamente
        setInterval(actualizarLotesSelector, 1000);
    </script>
</body>
</html>
