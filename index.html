<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor Cafetero Integral</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .section-form { display: none; }
        .section-form.active { display: block; }
        .nav-formas button { margin: 5px; }
        .list-group-item { transition: all 0.3s; }
        .badge-movimiento { font-size: 0.8em; }
        .total-display { background-color: #e9ecef; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <!-- Men√∫ de formularios -->
        <div class="nav-formas mb-4">
            <button class="btn btn-primary" onclick="mostrarFormulario('compras')">Compras</button>
            <button class="btn btn-success" onclick="mostrarFormulario('salidas')">Salidas</button>
            <button class="btn btn-info" onclick="mostrarFormulario('lotes')">Lotes</button>
            <button class="btn btn-warning" onclick="mostrarFormulario('mano-obra')">Mano de Obra</button>
        </div>

        <!-- Formulario de Compras -->
        <section id="form-compras" class="section-form active">
            <!-- ... (mantener mismo c√≥digo de compras) ... -->
        </section>

        <!-- Formulario de Salidas -->
        <section id="form-salidas" class="section-form">
            <!-- ... (mantener mismo c√≥digo de salidas) ... -->
        </section>

        <!-- Formulario de Lotes -->
        <section id="form-lotes" class="section-form">
            <!-- ... (mantener mismo c√≥digo de lotes) ... -->
        </section>

        <!-- Nuevo Formulario de Mano de Obra -->
        <section id="form-mano-obra" class="section-form">
            <h3>üë∑ Registro de Mano de Obra</h3>
            <form id="formManoObra">
                <div class="row g-3 mb-3">
                    <div class="col-md-3">
                        <select class="form-select" required id="loteObra">
                            <option value="">Seleccionar Lote</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" required id="actividad">
                            <option value="">Actividad</option>
                            <option value="Adecuacion del terreno">Adecuaci√≥n del terreno</option>
                            <option value="Trazado">Trazado</option>
                            <option value="Ahoyado">Ahoyado</option>
                            <option value="Siembra">Siembra</option>
                            <option value="Fertilizacion">Fertilizaci√≥n</option>
                            <option value="Control de arvenses">Control de arvenses</option>
                            <option value="Control de plagas">Control de plagas</option>
                            <option value="Control de enfermedades">Control de enfermedades</option>
                            <option value="Zoqueo">Zoqueo</option>
                            <option value="Resiembra">Resiembra</option>
                            <option value="Plateo">Plateo</option>
                            <option value="Deschupona">Deschupona</option>
                            <option value="Global">Global</option>
                            <option value="Recoleccion">Recolecci√≥n</option>
                            <option value="Beneficio">Beneficio</option>
                            <option value="Secado">Secado</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <input type="number" step="0.5" class="form-control" placeholder="Jornales" required id="jornales">
                    </div>
                    <div class="col-md-2">
                        <select class="form-select" required id="tipoPago">
                            <option value="Dia">D√≠a</option>
                            <option value="Contrato">Contrato</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <input type="number" step="1000" class="form-control" placeholder="Valor Unitario" required id="valorUnitario">
                    </div>
                    <div class="col-md-2">
                        <div class="total-display">
                            Total: $<span id="totalObra">0</span>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <button type="submit" class="btn btn-warning w-100">üíº Registrar Mano de Obra</button>
                    </div>
                </div>
            </form>
            
            <h4 class="mt-4">üìã Registros de Mano de Obra</h4>
            <div class="list-group" id="listaManoObra"></div>
        </section>

        <!-- Secci√≥n de Listados -->
        <div class="row mt-4">
            <!-- ... (mantener mismos listados anteriores) ... -->
            <div class="col-md-4">
                <h4>üë∑ Mano de Obra</h4>
                <div class="list-group" id="listaResumenObra"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Base de datos actualizada
        let db = {
            compras: JSON.parse(localStorage.getItem('compras')) || [],
            salidas: JSON.parse(localStorage.getItem('salidas')) || [],
            lotes: JSON.parse(localStorage.getItem('lotes')) || [],
            manoObra: JSON.parse(localStorage.getItem('manoObra')) || [],
            bodega: JSON.parse(localStorage.getItem('bodega')) || []
        };

        // Funciones de UI actualizadas
        function actualizarUI() {
            // ... (mantener actualizaciones anteriores) ...
            actualizarSelectLotes();
            actualizarListaManoObra();
            actualizarResumenObra();
            localStorage.setItem('manoObra', JSON.stringify(db.manoObra));
        }

        function actualizarSelectLotes() {
            const select = document.getElementById('loteObra');
            select.innerHTML = '<option value="">Seleccionar Lote</option>' + 
                db.lotes.map(lote => `
                    <option value="${lote.numero}">Lote #${lote.numero} - ${lote.variedad}</option>
                `).join('');
        }

        function actualizarListaManoObra() {
            const contenedor = document.getElementById('listaManoObra');
            contenedor.innerHTML = db.manoObra.map((obra, index) => `
                <div class="list-group-item">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>${obra.actividad}</strong><br>
                            <small>Lote #${obra.lote} - ${obra.jornales} jornales</small>
                        </div>
                        <div class="text-end">
                            <div>$${obra.total.toLocaleString()}</div>
                            <button class="btn btn-sm btn-danger mt-1" onclick="eliminarManoObra(${index})">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function actualizarResumenObra() {
            const contenedor = document.getElementById('listaResumenObra');
            const resumen = db.manoObra.slice(-5).reverse().map(obra => `
                <div class="list-group-item">
                    <div class="d-flex justify-content-between">
                        <div>
                            <small>${obra.actividad}</small><br>
                            <small class="text-muted">Lote ${obra.lote}</small>
                        </div>
                        <small>$${obra.total.toLocaleString()}</small>
                    </div>
                </div>
            `).join('');
            contenedor.innerHTML = resumen || '<div class="list-group-item">No hay registros</div>';
        }

        // Funciones para mano de obra
        function calcularTotalObra() {
            const jornales = parseFloat(document.getElementById('jornales').value) || 0;
            const valor = parseFloat(document.getElementById('valorUnitario').value) || 0;
            document.getElementById('totalObra').textContent = (jornales * valor).toLocaleString();
        }

        function eliminarManoObra(index) {
            if (confirm('¬øEliminar este registro?')) {
                db.manoObra.splice(index, 1);
                actualizarUI();
            }
        }

        // Eventos actualizados
        document.getElementById('formManoObra').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nuevaObra = {
                lote: document.getElementById('loteObra').value,
                actividad: document.getElementById('actividad').value,
                jornales: parseFloat(document.getElementById('jornales').value),
                tipoPago: document.getElementById('tipoPago').value,
                valorUnitario: parseFloat(document.getElementById('valorUnitario').value),
                total: parseFloat(document.getElementById('totalObra').textContent.replace(/,/g, '')),
                fecha: new Date().toISOString()
            };

            if (!db.lotes.some(l => l.numero == nuevaObra.lote)) {
                alert("¬°El lote seleccionado no existe!");
                return;
            }

            db.manoObra.push(nuevaObra);
            this.reset();
            document.getElementById('totalObra').textContent = '0';
            actualizarUI();
        });

        document.getElementById('jornales').addEventListener('input', calcularTotalObra);
        document.getElementById('valorUnitario').addEventListener('input', calcularTotalObra);

        // Inicializaci√≥n
        actualizarUI();
    </script>
</body>
</html>
