<!DOCTYPE html>
<html>
<head>
    <title>Finca Caf√© M√°gico üå±</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .seccion { background: #e0f7fa; padding: 20px; margin: 10px; border-radius: 10px; }
        .columnas-magicas { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        label { display: block; margin: 10px 0 5px; color: #2e7d32; font-weight: bold; }
        input, button { margin: 5px; padding: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #4CAF50; padding: 8px; }
    </style>
</head>
<body>
    <!-- Formulario de Informaci√≥n de la Finca -->
    <div class="seccion">
        <h2>üìã Informaci√≥n de la Finca</h2>
        <form onsubmit="guardarFinca(event)">
            <!-- Campos del formulario -->
        </form>
    </div>

    <!-- Formulario de Compras de Insumos -->
    <div class="seccion">
        <h2>üõí Compras de Insumos</h2>
        <form onsubmit="comprarInsumo(event)">
            <!-- Campos del formulario -->
        </form>
    </div>

    <!-- Bodega de Insumos -->
    <div class="seccion">
        <h2>üì¶ Bodega de Insumos</h2>
        <table id="tablaBodega">
            <!-- Tabla de insumos -->
        </table>
    </div>

    <!-- Formulario de Lotes de Caf√© -->
    <div class="seccion">
        <h2>üå± Lotes de Caf√©</h2>
        <form id="loteForm" onsubmit="guardarLote(event)">
            <!-- Campos del formulario -->
        </form>
    </div>

    <!-- Formulario para Usar Insumos en Lotes -->
    <div class="seccion">
        <h2>üì¶ Usar Insumos en Lotes</h2>
        <form onsubmit="usarInsumo(event)">
            <!-- Selectores y campos -->
        </form>
    </div>

    <!-- Reportes -->
    <div class="seccion">
        <h2>üìä Reporte de Lotes de Caf√©</h2>
        <button onclick="generarReporteLotes()">üñ®Ô∏è Generar Reporte</button>
        <table id="reporteLotes">
            <!-- Tabla de reporte -->
        </table>
    </div>

    <script>
        let bodega = JSON.parse(localStorage.getItem('bodega')) || {};
        let lotes = JSON.parse(localStorage.getItem('lotes')) || [];
        let datosFinca = JSON.parse(localStorage.getItem('datosFinca')) || {
            nombre: "", areaTotal: 0, propietario: "", vereda: "", municipio: ""
        };

        // Funci√≥n para cargar datos en selectores
        function cargarDatos() {
            const selectLote = document.getElementById('loteUso');
            selectLote.innerHTML = '<option value="">Elige un lote</option>';
            lotes.forEach(lote => {
                const option = document.createElement('option');
                option.value = lote.numero;
                option.textContent = `Lote ${lote.numero}`;
                selectLote.appendChild(option);
            });

            const selectInsumo = document.getElementById('insumoUso');
            selectInsumo.innerHTML = '<option value="">Elige insumo</option>';
            for (const insumo in bodega) {
                const option = document.createElement('option');
                option.value = insumo;
                option.textContent = `${insumo} (${bodega[insumo].existencia} ${bodega[insumo].unidad})`;
                selectInsumo.appendChild(option);
            }
        }

        // Funci√≥n para guardar un lote
        function guardarLote(event) {
            event.preventDefault();
            const nuevoLote = {
                numero: document.getElementById('numLote').value,
                area: parseFloat(document.getElementById('areaLote').value),
                distanciaCalles: parseFloat(document.getElementById('distanciaCalles').value),
                distanciaPlantas: parseFloat(document.getElementById('distanciaPlantas').value),
                densidad: document.getElementById('densidad').value,
                numPlantas: document.getElementById('numPlantas').value
            };
            lotes.push(nuevoLote);
            localStorage.setItem('lotes', JSON.stringify(lotes));
            alert("‚úÖ ¬°Lote guardado!");
            document.getElementById('loteForm').reset();
            cargarDatos(); // Actualizar selectores
        }

        // Funci√≥n para comprar insumos
        function comprarInsumo(event) {
            event.preventDefault();
            const insumo = document.getElementById('insumo').value;
            const cantidad = parseFloat(document.getElementById('cantidadCompra').value);
            if (bodega[insumo]) {
                bodega[insumo].existencia += cantidad;
            } else {
                bodega[insumo] = { existencia: cantidad, unidad: 'kg' };
            }
            localStorage.setItem('bodega', JSON.stringify(bodega));
            alert(`‚úÖ ¬°Agregados ${cantidad} kg de ${insumo}!`);
            cargarDatos(); // Actualizar selectores
        }

        // Cargar datos al iniciar
        window.onload = function () {
            cargarDatos();
            actualizarBodega();
        };
    </script>
</body>
</html>
