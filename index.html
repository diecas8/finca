<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor Finca Cafetera - Formularios Completos</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; }
        .form-group { margin-bottom: 10px; }
        .form-group label { display: block; margin-bottom: 5px; }
        input, select, button { width: 100%; padding: 8px; margin-bottom: 10px; }
        button { background: #28a745; color: white; border: none; cursor: pointer; }
        button:hover { background: #218838; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    </style>
</head>
<body>

    <!-- Encabezado -->
    <div class="section">
        <h2>Información General de la Finca</h2>
        <form id="formFinca">
            <div class="form-group">
                <label>Nombre de la finca:</label>
                <input type="text" id="nombreFinca" required>
            </div>
            <div class="form-group">
                <label>Área total (ha):</label>
                <input type="number" id="areaTotal" required>
            </div>
            <div class="form-group">
                <label>Propietario:</label>
                <input type="text" id="propietario" required>
            </div>
            <div class="form-group">
                <label>Vereda:</label>
                <input type="text" id="vereda" required>
            </div>
            <div class="form-group">
                <label>Municipio:</label>
                <input type="text" id="municipio" required>
            </div>
            <button type="submit">Guardar Información</button>
        </form>
    </div>

    <!-- Compra de Insumos -->
    <div class="section">
        <h2>Compra de Insumos</h2>
        <form id="formCompra">
            <div class="form-group">
                <label>Fecha:</label>
                <input type="date" id="fechaCompra" required>
            </div>
            <div class="form-group">
                <label>Insumo:</label>
                <input type="text" id="insumoCompra" required>
            </div>
            <div class="form-group">
                <label>Unidad de medida:</label>
                <input type="text" id="unidadCompra" required>
            </div>
            <div class="form-group">
                <label>Cantidad:</label>
                <input type="number" id="cantidadCompra" required>
            </div>
            <div class="form-group">
                <label>Valor unitario:</label>
                <input type="number" id="valorUnitario" required>
            </div>
            <button type="submit">Registrar Compra</button>
        </form>
    </div>

    <!-- Lotes -->
    <div class="section">
        <h2>Gestión de Lotes</h2>
        <form id="formLote">
            <div class="form-group">
                <label>Número de lote:</label>
                <input type="text" id="numLote" required>
            </div>
            <div class="form-group">
                <label>Variedad de café:</label>
                <input type="text" id="variedadLote" required>
            </div>
            <div class="form-group">
                <label>Área (ha):</label>
                <input type="number" id="areaLote" required>
            </div>
            <div class="form-group">
                <label>Tipo de labor:</label>
                <input type="text" id="tipoLabor" required>
            </div>
            <div class="form-group">
                <label>Fecha de labor:</label>
                <input type="date" id="fechaLabor" required>
            </div>
            <div class="form-group">
                <label>Distancia entre calles (m):</label>
                <input type="number" id="distanciaCalles" required>
            </div>
            <div class="form-group">
                <label>Distancia entre plantas (m):</label>
                <input type="number" id="distanciaPlantas" required>
            </div>
            <button type="submit">Guardar Lote</button>
        </form>
    </div>

    <!-- Aplicación de Insumos por Lote -->
    <div class="section">
        <h2>Aplicación de Insumos por Lote</h2>
        <form id="formAplicacion">
            <div class="form-group">
                <label>Lote:</label>
                <select id="loteAplicacion" required></select>
            </div>
            <div class="form-group">
                <label>Fecha:</label>
                <input type="date" id="fechaAplicacion" required>
            </div>
            <div class="form-group">
                <label>Insumo:</label>
                <select id="insumoAplicacion" required></select>
            </div>
            <div class="form-group">
                <label>Unidad de medida:</label>
                <input type="text" id="unidadAplicacion" required>
            </div>
            <div class="form-group">
                <label>Cantidad:</label>
                <input type="number" id="cantidadAplicacion" required>
            </div>
            <button type="submit">Aplicar Insumo</button>
        </form>
    </div>

    <!-- Relación de Actividades por Lote -->
    <div class="section">
        <h2>Actividades por Lote</h2>
        <form id="formActividad">
            <div class="form-group">
                <label>Lote:</label>
                <select id="loteActividad" required></select>
            </div>
            <div class="form-group">
                <label>Fecha:</label>
                <input type="date" id="fechaActividad" required>
            </div>
            <div class="form-group">
                <label>Actividad:</label>
                <input type="text" id="nombreActividad" required>
            </div>
            <div class="form-group">
                <label>Cantidad de jornales:</label>
                <input type="number" id="jornales" required>
            </div>
            <div class="form-group">
                <label>Valor por jornal:</label>
                <input type="number" id="valorJornal" required>
            </div>
            <button type="submit">Registrar Actividad</button>
        </form>
    </div>

    <!-- Recolección de Café por Lote -->
    <div class="section">
        <h2>Recolección de Café</h2>
        <form id="formRecoleccion">
            <div class="form-group">
                <label>Lote:</label>
                <select id="loteRecoleccion" required></select>
            </div>
            <div class="form-group">
                <label>Fecha:</label>
                <input type="date" id="fechaRecoleccion" required>
            </div>
            <div class="form-group">
                <label>Cantidad de café (kg):</label>
                <input type="number" id="cantidadCafe" required>
            </div>
            <div class="form-group">
                <label>Unidad de medida:</label>
                <input type="text" id="unidadRecoleccion" required>
            </div>
            <button type="submit">Registrar Recolección</button>
        </form>
    </div>

    <!-- Reportes -->
    <div class="section">
        <h2>Reportes</h2>
        <button onclick="generarPDF()">Generar PDF</button>
        <button onclick="generarExcel()">Exportar Excel</button>
    </div>

<script>
<script>
// Sistema de almacenamiento
let finca = JSON.parse(localStorage.getItem('finca')) || {};
let compras = JSON.parse(localStorage.getItem('compras')) || [];
let lotes = JSON.parse(localStorage.getItem('lotes')) || [];
let insumos = JSON.parse(localStorage.getItem('insumos')) || [];
let aplicaciones = JSON.parse(localStorage.getItem('aplicaciones')) || [];
let actividades = JSON.parse(localStorage.getItem('actividades')) || [];
let recolecciones = JSON.parse(localStorage.getItem('recolecciones')) || [];

// Función para guardar todos los datos
function guardarDatos() {
    localStorage.setItem('finca', JSON.stringify(finca));
    localStorage.setItem('compras', JSON.stringify(compras));
    localStorage.setItem('lotes', JSON.stringify(lotes));
    localStorage.setItem('insumos', JSON.stringify(insumos));
    localStorage.setItem('aplicaciones', JSON.stringify(aplicaciones));
    localStorage.setItem('actividades', JSON.stringify(actividades));
    localStorage.setItem('recolecciones', JSON.stringify(recolecciones));
    actualizarAreaCafe();
    actualizarSelectLotes();
}

// 1. Información General de la Finca
document.getElementById('formFinca').addEventListener('submit', (e) => {
    e.preventDefault();
    
    finca = {
        nombre: document.getElementById('nombreFinca').value,
        areaTotal: parseFloat(document.getElementById('areaTotal').value),
        propietario: document.getElementById('propietario').value,
        vereda: document.getElementById('vereda').value,
        municipio: document.getElementById('municipio').value
    };
    
    guardarDatos();
    e.target.reset();
    alert('Información de la finca guardada!');
});

// 2. Compra de Insumos
document.getElementById('formCompra').addEventListener('submit', (e) => {
    e.preventDefault();
    
    const nuevaCompra = {
        fecha: document.getElementById('fechaCompra').value,
        insumo: document.getElementById('insumoCompra').value,
        unidad: document.getElementById('unidadCompra').value,
        cantidad: parseFloat(document.getElementById('cantidadCompra').value),
        valorUnitario: parseFloat(document.getElementById('valorUnitario').value),
        total: parseFloat(document.getElementById('cantidadCompra').value) * 
              parseFloat(document.getElementById('valorUnitario').value)
    };
    
    // Actualizar inventario
    const insumoExistente = insumos.find(i => i.nombre === nuevaCompra.insumo);
    if(insumoExistente) {
        insumoExistente.cantidad += nuevaCompra.cantidad;
    } else {
        insumos.push({
            nombre: nuevaCompra.insumo,
            unidad: nuevaCompra.unidad,
            cantidad: nuevaCompra.cantidad
        });
    }
    
    compras.push(nuevaCompra);
    guardarDatos();
    e.target.reset();
    alert('Compra registrada e inventario actualizado!');
});

// 3. Gestión de Lotes
document.getElementById('formLote').addEventListener('submit', (e) => {
    e.preventDefault();
    
    const nuevoLote = {
        id: Date.now(),
        numero: document.getElementById('numLote').value,
        variedad: document.getElementById('variedadLote').value,
        area: parseFloat(document.getElementById('areaLote').value),
        labor: document.getElementById('tipoLabor').value,
        fechaLabor: document.getElementById('fechaLabor').value,
        distanciaCalles: parseFloat(document.getElementById('distanciaCalles').value),
        distanciaPlantas: parseFloat(document.getElementById('distanciaPlantas').value),
        densidad: 0,
        plantas: 0
    };
    
    // Cálculos automáticos
    nuevoLote.densidad = nuevoLote.area / 
                        (nuevoLote.distanciaCalles * nuevoLote.distanciaPlantas);
    nuevoLote.plantas = nuevoLote.area * nuevoLote.densidad;
    
    lotes.push(nuevoLote);
    guardarDatos();
    e.target.reset();
    alert('Lote registrado exitosamente!');
});

// 4. Aplicación de Insumos
document.getElementById('formAplicacion').addEventListener('submit', (e) => {
    e.preventDefault();
    
    const loteId = document.getElementById('loteAplicacion').value;
    const insumoNombre = document.getElementById('insumoAplicacion').value;
    const cantidad = parseFloat(document.getElementById('cantidadAplicacion').value);
    
    // Validar existencia
    const insumo = insumos.find(i => i.nombre === insumoNombre);
    if(!insumo || insumo.cantidad < cantidad) {
        alert('No hay suficiente insumo en inventario!');
        return;
    }
    
    // Registrar aplicación
    aplicaciones.push({
        fecha: document.getElementById('fechaAplicacion').value,
        loteId: loteId,
        insumo: insumoNombre,
        cantidad: cantidad,
        unidad: document.getElementById('unidadAplicacion').value
    });
    
    // Actualizar inventario
    insumo.cantidad -= cantidad;
    
    guardarDatos();
    e.target.reset();
    alert('Aplicación registrada!');
});

// 5. Actividades por Lote
document.getElementById('formActividad').addEventListener('submit', (e) => {
    e.preventDefault();
    
    const nuevaActividad = {
        fecha: document.getElementById('fechaActividad').value,
        loteId: document.getElementById('loteActividad').value,
        actividad: document.getElementById('nombreActividad').value,
        jornales: parseInt(document.getElementById('jornales').value),
        valorJornal: parseFloat(document.getElementById('valorJornal').value),
        total: parseInt(document.getElementById('jornales').value) * 
              parseFloat(document.getElementById('valorJornal').value)
    };
    
    actividades.push(nuevaActividad);
    guardarDatos();
    e.target.reset();
    alert('Actividad registrada!');
});

// 6. Recolección de Café
document.getElementById('formRecoleccion').addEventListener('submit', (e) => {
    e.preventDefault();
    
    const nuevaRecoleccion = {
        fecha: document.getElementById('fechaRecoleccion').value,
        loteId: document.getElementById('loteRecoleccion').value,
        cantidad: parseFloat(document.getElementById('cantidadCafe').value),
        unidad: document.getElementById('unidadRecoleccion').value
    };
    
    // Validar existencia del lote
    if(!lotes.find(l => l.id == nuevaRecoleccion.loteId)) {
        alert('El lote seleccionado no existe!');
        return;
    }
    
    recolecciones.push(nuevaRecoleccion);
    guardarDatos();
    e.target.reset();
    alert('Recolección registrada!');
});

// Funciones auxiliares
function actualizarAreaCafe() {
    const total = lotes.reduce((sum, lote) => sum + lote.area, 0);
    document.getElementById('areaCafe').textContent = total.toFixed(2);
}

function actualizarSelectLotes() {
    const selects = document.querySelectorAll('select[id^="lote"]');
    selects.forEach(select => {
        select.innerHTML = lotes.map(lote => `
            <option value="${lote.id}">${lote.numero} - ${lote.variedad}</option>
        `).join('');
    });
}

// Inicialización
function init() {
    if(finca.nombre) document.getElementById('nombreFinca').value = finca.nombre;
    actualizarSelectLotes();
    actualizarAreaCafe();
}

init();
</script>

</script>
</body>
</html>
