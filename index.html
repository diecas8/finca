<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finca Caf√© M√°gico üå±</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            color: #333;
        }

        .seccion {
            background-color: #e0f7fa;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        input, select {
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 5px;
            width: 100%;
            margin-bottom: 10px;
        }

        input:focus, select:focus {
            border-color: #4CAF50;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 8px;
            border: 1px solid #4CAF50;
        }
    </style>
</head>
<body>

<div class="seccion">
    <h2>üìã Informaci√≥n de la Finca</h2>
    <form id="fincaForm">
        <label for="nombreFinca">Nombre de la finca:</label>
        <input type="text" id="nombreFinca" required>

        <label for="areaTotal">√Årea total (hect√°reas):</label>
        <input type="number" step="0.01" id="areaTotal" required>

        <label for="propietario">Propietario:</label>
        <input type="text" id="propietario" required>

        <label for="vereda">Vereda:</label>
        <input type="text" id="vereda" required>

        <label for="municipio">Municipio:</label>
        <input type="text" id="municipio" required>

        <button type="submit">üíæ Guardar Finca</button>
    </form>
</div>

<div class="seccion">
    <h2>üå± Lotes de Caf√©</h2>
    <form id="loteForm">
        <label for="numLote">N√∫mero de lote:</label>
        <input type="text" id="numLote" required>

        <label for="areaLote">√Årea (hect√°reas):</label>
        <input type="number" step="0.01" id="areaLote" required>

        <label for="distanciaCalles">Distancia entre calles (metros):</label>
        <input type="number" step="0.01" id="distanciaCalles" required>

        <label for="distanciaPlantas">Distancia entre plantas (metros):</label>
        <input type="number" step="0.01" id="distanciaPlantas" required>

        <label for="densidad">Densidad (plantas/ha):</label>
        <input type="text" id="densidad" readonly>

        <label for="numPlantas">Total de plantas:</label>
        <input type="text" id="numPlantas" readonly>

        <button type="button" onclick="guardarLote()">üíæ Guardar Lote</button>
    </form>
</div>

<div class="seccion">
    <h2>üì¶ Usar Insumos en Lotes</h2>
    <select id="loteUso">
        <option>Elige un lote</option>
    </select>

    <select id="insumoUso">
        <option>Elige un insumo</option>
    </select>

    <input type="number" step="0.01" id="cantidadUso" placeholder="Cantidad a usar">
    <button onclick="usarInsumo()">‚ûñ Usar</button>
</div>

<div class="seccion">
    <h2>üõí Comprar Insumos</h2>
    <input type="text" id="insumo" placeholder="Nombre del insumo" required>
    <input type="number" step="0.01" id="cantidadCompra" placeholder="Cantidad" required>
    <input type="text" id="unidadInsumo" placeholder="Unidad (ej. kg)" required>
    <button onclick="comprarInsumo()">üõí Agregar</button>
</div>

<div class="seccion">
    <h2>üì¶ Bodega de Insumos</h2>
    <table id="tablaBodega">
        <tr>
            <th>Insumo</th>
            <th>Unidad</th>
            <th>En Stock</th>
            <th>√öltima Compra</th>
        </tr>
    </table>
</div>

<script>
    // Inicializaci√≥n de variables
    let bodega = JSON.parse(localStorage.getItem('bodega')) || {};
    let lotes = JSON.parse(localStorage.getItem('lotes')) || [];

    // Funci√≥n para guardar la finca
    document.getElementById('fincaForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const finca = {
            nombre: document.getElementById('nombreFinca').value,
            areaTotal: parseFloat(document.getElementById('areaTotal').value),
            propietario: document.getElementById('propietario').value,
            vereda: document.getElementById('vereda').value,
            municipio: document.getElementById('municipio').value
        };
        localStorage.setItem('finca', JSON.stringify(finca));
        alert('‚úÖ ¬°Finca guardada!');
    });

    // Funci√≥n para guardar el lote
    function guardarLote() {
        const numeroLote = document.getElementById('numLote').value;
        const area = parseFloat(document.getElementById('areaLote').value);
        const distanciaCalles = parseFloat(document.getElementById('distanciaCalles').value);
        const distanciaPlantas = parseFloat(document.getElementById('distanciaPlantas').value);
        const densidad = (10000 / (distanciaCalles * distanciaPlantas)).toFixed(2); // C√°lculo de densidad
        const numPlantas = Math.round(area * densidad);

        const nuevoLote = { numero: numeroLote, area, distanciaCalles, distanciaPlantas, densidad, numPlantas };
        
        // Asegurarnos de que lotes sea un array
        if (!Array.isArray(lotes)) {
            lotes = [];
        }

        lotes.push(nuevoLote);
        localStorage.setItem('lotes', JSON.stringify(lotes));
        actualizarListaLotes();
        alert("‚úÖ ¬°Lote guardado!");
        document.getElementById('loteForm').reset();
    }

    // Funci√≥n para actualizar la lista de lotes en el select
    function actualizarListaLotes() {
        const selectLotes = document.getElementById('loteUso');
        selectLotes.innerHTML = `<option>Elige un lote</option>`;
        
        lotes.forEach(lote => {
            const option = document.createElement('option');
            option.value = lote.numero;
            option.textContent = `Lote ${lote.numero}`;
            selectLotes.appendChild(option);
        });
    }

  function comprarInsumo() {
    const insumo = document.getElementById('insumo').value;
    const cantidad = parseFloat(document.getElementById('cantidadCompra').value);
    const unidad = document.getElementById('unidadInsumo').value;

    // Verificamos que todos los campos sean v√°lidos
    if (!insumo || cantidad <= 0 || !unidad) {
        alert("üö® ¬°Por favor completa todos los campos!");
        return;
    }

    // Si el insumo ya existe, actualizamos la cantidad
    if (bodega[insumo]) {
        bodega[insumo].existencia += cantidad;
    } else {
        // Si no existe, lo agregamos a la bodega
        bodega[insumo] = { existencia: cantidad, unidad: unidad };
    }

    // Guardamos la bodega actualizada en localStorage
    localStorage.setItem('bodega', JSON.stringify(bodega));

    // Actualizamos la tabla de la bodega
    actualizarBodega();

    // Actualizamos el desplegable de insumos
    actualizarListaInsumos();

    // Confirmaci√≥n
    alert(`‚úÖ ¬°${cantidad} ${unidad} de ${insumo} agregados a la bodega!`);
}
    function actualizarBodega() {
    const tabla = document.getElementById('tablaBodega');
    tabla.innerHTML = `
        <tr>
            <th>Insumo</th>
            <th>Unidad</th>
            <th>En Stock</th>
            <th>√öltima Compra</th>
        </tr>`;  // Encabezado de la tabla

    // Mostrar los insumos en la bodega
    for (let insumo in bodega) {
        tabla.innerHTML += `
            <tr>
                <td>${insumo}</td>
                <td>${bodega[insumo].unidad}</td>
                <td>${bodega[insumo].existencia.toFixed(2)}</td>
                <td>${new Date().toLocaleDateString()}</td>
            </tr>`;
    }
}

function actualizarListaInsumos() {
    const selectInsumos = document.getElementById('insumoUso');
    selectInsumos.innerHTML = `<option>Elige un insumo</option>`;  // Opci√≥n predeterminada

    // Recuperamos los insumos desde la bodega
    for (let insumo in bodega) {
        const option = document.createElement('option');
        option.value = insumo;
        option.textContent = insumo;  // Mostramos el nombre del insumo
        selectInsumos.appendChild(option);  // Agregamos la opci√≥n al select
    }
}

    // Funci√≥n para usar insumo
    function usarInsumo() {
    const loteSeleccionado = document.getElementById('loteUso').value;
    const insumoSeleccionado = document.getElementById('insumoUso').value;
    const cantidad = parseFloat(document.getElementById('cantidadUso').value);

    // Verificamos que todo est√© correcto
    if (!loteSeleccionado || !insumoSeleccionado || cantidad <= 0) {
        alert("üö® ¬°Por favor, selecciona un lote, un insumo y una cantidad v√°lida!");
        return;
    }

    // Verificamos si el insumo existe y si hay suficiente cantidad
    if (bodega[insumoSeleccionado] && bodega[insumoSeleccionado].existencia >= cantidad) {
        // Restamos la cantidad usada de la bodega
        bodega[insumoSeleccionado].existencia -= cantidad;

        // Guardamos la bodega actualizada
        localStorage.setItem('bodega', JSON.stringify(bodega));

        // Actualizamos la bodega y la tabla
        actualizarBodega();
        alert(`‚úÖ ¬°${cantidad} de ${insumoSeleccionado} usados en el Lote ${loteSeleccionado}!`);
    } else {
        alert("üö® ¬°No tienes suficiente cantidad de este insumo en la bodega!");
    }
}


    // Cargar la informaci√≥n al inicio
    window.onload = function() {
        actualizarListaLotes();
        actualizarBodega();       // Cargar la bodega con los insumos
    actualizarListaInsumos(); // Cargar los insumos al desplegable
    };
</script>

</body>
</html>
