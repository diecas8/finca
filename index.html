<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema Integral de Gesti√≥n Cafetera</title>
    <style>
        /* Estilos generales */
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 0; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 1200px; 
            margin: 20px auto; 
            padding: 20px; 
            background: white; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }
        h1 { 
            text-align: center; 
            color: #2E8B57; 
            margin-bottom: 20px; 
        }

        /* Estilos para las pesta√±as */
        .tabs { 
            display: flex; 
            justify-content: center; 
            margin-bottom: 20px; 
        }
        .tab-button { 
            padding: 10px 20px; 
            margin: 0 5px; 
            background: #2E8B57; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            transition: background 0.3s; 
        }
        .tab-button:hover { 
            background: #3CB371; 
        }
        .tab-button.active { 
            background: #3CB371; 
        }

        /* Estilos para los formularios */
        .form-container { 
            display: none; 
            padding: 20px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            background: #f9f9f9; 
        }
        .form-container.active { 
            display: block; 
        }
        .form-group { 
            margin-bottom: 15px; 
            display: grid; 
            grid-template-columns: 150px 1fr; 
            align-items: center; 
            gap: 10px; 
        }
        input, select { 
            padding: 8px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
        }
        button { 
            background-color: #2E8B57; 
            color: white; 
            padding: 8px 15px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
        }
        button:hover { 
            background-color: #3CB371; 
        }

        /* Estilos para las tablas */
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
        }
        th, td { 
            border: 1px solid #ddd; 
            padding: 10px; 
            text-align: left; 
        }
        th { 
            background-color: #2E8B57; 
            color: white; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèûÔ∏è Sistema de Gesti√≥n Cafetera</h1>

        <!-- Pesta√±as para navegar entre formularios -->
        <div class="tabs">
            <button class="tab-button active" onclick="mostrarFormulario('lotes')">üå± Lotes</button>
            <button class="tab-button" onclick="mostrarFormulario('actividades')">üë∑ Actividades</button>
            <button class="tab-button" onclick="mostrarFormulario('insumos')">üõí Insumos</button>
            <button class="tab-button" onclick="mostrarFormulario('usoInsumos')">üì¶ Uso de Insumos</button>
        </div>

        <!-- Formulario de Lotes -->
        <div id="lotes" class="form-container active">
            <h2>üå± Registro de Lotes</h2>
            <form id="loteForm">
                <div class="form-group">
                    <label>N¬∞ Lote:</label>
                    <input type="number" id="numeroLote" required>
                </div>
                <div class="form-group">
                    <label>Variedad:</label>
                    <select id="variedad" required>
                        <option value="">Seleccione</option>
                        <option>Castillo</option>
                        <option>Cenicafe</option>
                        <option>Colombia</option>
                        <option>Geisha</option>
                        <option>Borbon</option>
                        <option>Caturra</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>√Årea (ha):</label>
                    <input type="number" step="0.01" id="area" required>
                </div>
                <div class="form-group">
                    <label>Tipo Labor:</label>
                    <select id="tipoLabor" required>
                        <option value="">Seleccione</option>
                        <option>Siembra nueva</option>
                        <option>Renovacion siembra</option>
                        <option>Renovacion zoca</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Fecha Labor:</label>
                    <input type="date" id="fechaLabor" required>
                </div>
                <div class="form-group">
                    <label>Surco (m):</label>
                    <input type="number" step="0.01" id="distanciaSurco" required>
                </div>
                <div class="form-group">
                    <label>Entre plantas (m):</label>
                    <input type="number" step="0.01" id="distanciaPlantas" required>
                </div>
                <button type="button" onclick="guardarLote()">Guardar Lote</button>
            </form>
        </div>

        <!-- Formulario de Actividades -->
        <div id="actividades" class="form-container">
            <h2>üë∑ Registro de Actividades</h2>
            <form id="manoObraForm">
                <div class="form-group">
                    <label>Lote:</label>
                    <select id="loteManoObra" required></select>
                </div>
                <div class="form-group">
                    <label>Tipo de Labor:</label>
                    <select id="tipoLaborMano" required>
                        <option value="">Seleccione</option>
                        <option>Adecuacion de terreno</option>
                        <option>Trazado</option>
                        <option>Ahoyado</option>
                        <option>Siembra</option>
                        <option>Resiembra</option>
                        <option>Fertilizacion</option>
                        <option>Control de arvenses</option>
                        <option>Control de plagas</option>
                        <option>Plateo</option>
                        <option>Encalado</option>
                        <option>Zoqueo</option>
                        <option>Recoleccion</option>
                        <option>Otro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>N¬∞ Jornales:</label>
                    <input type="number" id="jornales" step="0.5" required>
                </div>
                <div class="form-group">
                    <label>Tipo Jornal:</label>
                    <select id="tipoJornal" required>
                        <option>Al d√≠a</option>
                        <option>Guada√±a</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Valor Jornal:</label>
                    <input type="number" id="valorJornal" step="1000" required>
                </div>
                <div class="total-box">
                    üí∞ Valor Total: $<span id="valorTotal">0</span>
                </div>
                <button type="button" onclick="guardarManoObra()">Guardar Actividad</button>
            </form>
        </div>

        <!-- Formulario de Insumos -->
        <div id="insumos" class="form-container">
            <h2>üõí Registro de Insumos</h2>
            <form id="insumosForm">
                <div class="form-group">
                    <label>Fecha de Compra:</label>
                    <input type="date" id="fechaCompra" required>
                </div>
                <div class="form-group">
                    <label>Insumo:</label>
                    <div style="display: flex; gap: 5px;">
                        <select id="tipoInsumo" required>
                            <option value="">Seleccionar</option>
                            <option>Urea</option>
                            <option>Dap</option>
                            <option>KCL</option>
                            <option>Cal dolomita</option>
                            <option>Cal agricola</option>
                            <option>Cal apagada</option>
                            <option>Insecticida</option>
                            <option>Fungicida</option>
                            <option>Herbicida</option>
                            <option>Alambre</option>
                            <option>Grapas</option>
                            <option>Puntilla</option>
                            <option>Gasolina</option>
                            <option>Aceite</option>
                            <option>Coco Recolector</option>
                            <option>Cuchilla Guada√±a</option>
                            <option>Lima</option>
                            <option>Machete</option>
                            <option>Pal√≠n</option>
                            <option>Costales</option>
                        </select>
                        <input type="text" id="nuevoInsumo" placeholder="Nuevo insumo" style="flex: 1;">
                        <button type="button" onclick="agregarInsumo()">‚ûï</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Unidad de Medida:</label>
                    <select id="unidadMedida" required>
                        <option>Bulto</option>
                        <option>Kilo</option>
                        <option>Litro</option>
                        <option>Gal√≥n</option>
                        <option>Unidad</option>
                        <option>Cuarto</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Cantidad:</label>
                    <input type="number" step="0.01" id="cantidadInsumo" required>
                </div>
                <div class="form-group">
                    <label>Valor Unitario:</label>
                    <input type="number" id="valorUnitario" required>
                </div>
                <div class="total-box">
                    üí∞ Valor Total: $<span id="totalInsumo">0</span>
                </div>
                <button type="button" onclick="guardarInsumo()">Guardar Insumo</button>
            </form>
        </div>

        <!-- Formulario de Uso de Insumos -->
        <div id="usoInsumos" class="form-container">
            <h2>üì¶ Uso de Insumos en Lotes</h2>
            <form id="usoInsumosForm">
                <div class="form-group">
                    <label>Lote:</label>
                    <select id="loteUsoInsumo" required></select>
                </div>
                <div class="form-group">
                    <label>Insumo:</label>
                    <select id="insumoDisponible" required></select>
                </div>
                <div class="form-group">
                    <label>Cantidad a usar:</label>
                    <input type="number" step="0.01" id="cantidadUso" required>
                </div>
                <div class="form-group">
                    <label>Fecha de uso:</label>
                    <input type="date" id="fechaUso" required>
                </div>
                <button type="button" onclick="registrarUsoInsumo()">Registrar Uso</button>
            </form>
        </div>

        <!-- Tablas de Registros -->
        <div class="grid-container">
            <div class="form-container">
                <h3>üìã Lotes Registrados</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Lote</th>
                            <th>Variedad</th>
                            <th>√Årea</th>
                            <th>Labor</th>
                            <th>Densidad</th>
                            <th>Plantas</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="registrosLotes"></tbody>
                </table>
            </div>

            <div class="form-container">
                <h3>üìã Actividades Registradas</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Lote</th>
                            <th>Actividad</th>
                            <th>Jornales</th>
                            <th>Tipo</th>
                            <th>Valor Total</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="registrosMO"></tbody>
                </table>
            </div>

            <div class="form-container">
                <h3>üìã Insumos Registrados</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Insumo</th>
                            <th>Unidad</th>
                            <th>Cantidad</th>
                            <th>Disponible</th>
                            <th>V. Unitario</th>
                            <th>Total</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="registrosInsumos"></tbody>
                </table>
            </div>

            <div class="form-container">
                <h3>üìã Insumos Utilizados por Lote</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Lote</th>
                            <th>Insumo</th>
                            <th>Cantidad</th>
                            <th>Unidad</th>
                            <th>Fecha Uso</th>
                        </tr>
                    </thead>
                    <tbody id="registrosUsoInsumos"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let lotes = [];
        let manoObra = [];
        let insumos = [];
        let usoInsumos = [];
        let editandoMO = false;
        let indiceEdicionMO = null;
        let editandoInsumo = false;
        let indiceEdicionInsumo = null;

        // Funci√≥n para mostrar/ocultar formularios
        function mostrarFormulario(id) {
            const formularios = document.querySelectorAll('.form-container');
            formularios.forEach(form => form.classList.remove('active'));
            document.getElementById(id).classList.add('active');

            const botones = document.querySelectorAll('.tab-button');
            botones.forEach(boton => boton.classList.remove('active'));
            document.querySelector(`[onclick="mostrarFormulario('${id}')"]`).classList.add('active');
        }

        // Funciones para Lotes
        function guardarLote() {
            const lote = {
                numero: parseInt(document.getElementById('numeroLote').value),
                variedad: document.getElementById('variedad').value,
                area: parseFloat(document.getElementById('area').value),
                labor: document.getElementById('tipoLabor').value,
                fecha: document.getElementById('fechaLabor').value,
                surco: parseFloat(document.getElementById('distanciaSurco').value),
                plantas: parseFloat(document.getElementById('distanciaPlantas').value)
            };

            lote.densidad = 10000 / (lote.surco * lote.plantas);
            lote.totalPlantas = Math.round(lote.densidad * lote.area);

            const index = lotes.findIndex(l => l.numero === lote.numero);
            if (index >= 0) {
                lotes[index] = lote;
            } else {
                lotes.push(lote);
            }

            actualizarTablaLotes();
            actualizarLotesSelector();
            document.getElementById('loteForm').reset();
        }

        function actualizarTablaLotes() {
            const tbody = document.getElementById('registrosLotes');
            tbody.innerHTML = lotes.map(lote => `
                <tr>
                    <td>${lote.numero}</td>
                    <td>${lote.variedad}</td>
                    <td>${lote.area} ha</td>
                    <td>${lote.labor}</td>
                    <td>${lote.densidad.toFixed(2)}/ha</td>
                    <td>${lote.totalPlantas.toLocaleString()}</td>
                    <td><button onclick="eliminarLote(${lote.numero})">Eliminar</button></td>
                </tr>
            `).join('');
        }

        function eliminarLote(numero) {
            lotes = lotes.filter(l => l.numero !== numero);
            manoObra = manoObra.filter(m => m.lote !== numero);
            actualizarTablaLotes();
            actualizarTablaMO();
            actualizarLotesSelector();
        }

        // Funciones para Actividades
        function actualizarLotesSelector() {
            const selector = document.getElementById('loteManoObra');
            const valorActual = selector.value;
            
            selector.innerHTML = '<option value="">Seleccionar Lote</option>';
            lotes.forEach(lote => {
                const option = document.createElement('option');
                option.value = lote.numero;
                option.textContent = `Lote ${lote.numero} - ${lote.variedad}`;
                selector.appendChild(option);
            });
            
            selector.value = valorActual;
        }

        function calcularTotal() {
            const jornales = parseFloat(document.getElementById('jornales').value) || 0;
            const valor = parseFloat(document.getElementById('valorJornal').value) || 0;
            document.getElementById('valorTotal').textContent = (jornales * valor).toLocaleString();
        }

        function guardarManoObra() {
            const registro = {
                lote: parseInt(document.getElementById('loteManoObra').value),
                labor: document.getElementById('tipoLaborMano').value,
                jornales: parseFloat(document.getElementById('jornales').value),
                tipo: document.getElementById('tipoJornal').value,
                valor: parseFloat(document.getElementById('valorJornal').value),
                total: parseFloat(document.getElementById('valorTotal').textContent.replace(/,/g, ''))
            };

            if (!lotes.some(l => l.numero === registro.lote)) {
                alert('¬°Primero debe registrar el lote!');
                return;
            }

            if (editandoMO) {
                manoObra[indiceEdicionMO] = registro;
                editandoMO = false;
                indiceEdicionMO = null;
            } else {
                manoObra.push(registro);
            }

            actualizarTablaMO();
            document.getElementById('manoObraForm').reset();
            document.getElementById('valorTotal').textContent = '0';
        }

        function actualizarTablaMO() {
            const tbody = document.getElementById('registrosMO');
            tbody.innerHTML = manoObra.map((registro, index) => `
                <tr>
                    <td>${registro.lote}</td>
                    <td>${registro.labor}</td>
                    <td>${registro.jornales}</td>
                    <td>${registro.tipo}</td>
                    <td>$${registro.total.toLocaleString()}</td>
                    <td>
                        <button onclick="editarMO(${index})">Editar</button>
                        <button onclick="eliminarMO(${index})">Eliminar</button>
                    </td>
                </tr>
            `).join('');
        }

        function editarMO(index) {
            const registro = manoObra[index];
            document.getElementById('loteManoObra').value = registro.lote;
            document.getElementById('tipoLaborMano').value = registro.labor;
            document.getElementById('jornales').value = registro.jornales;
            document.getElementById('tipoJornal').value = registro.tipo;
            document.getElementById('valorJornal').value = registro.valor;
            calcularTotal();
            editandoMO = true;
            indiceEdicionMO = index;
        }

        function eliminarMO(index) {
            manoObra.splice(index, 1);
            actualizarTablaMO();
        }

        // Funciones para Insumos
        function agregarInsumo() {
            const nuevo = document.getElementById('nuevoInsumo').value.trim();
            if (nuevo) {
                const select = document.getElementById('tipoInsumo');
                const option = document.createElement('option');
                option.value = nuevo;
                option.textContent = nuevo;
                select.appendChild(option);
                document.getElementById('nuevoInsumo').value = '';
            }
        }

        function calcularTotalInsumo() {
            const cantidad = parseFloat(document.getElementById('cantidadInsumo').value) || 0;
            const valor = parseFloat(document.getElementById('valorUnitario').value) || 0;
            document.getElementById('totalInsumo').textContent = (cantidad * valor).toLocaleString();
        }

        function guardarInsumo() {
            const insumo = {
                fecha: document.getElementById('fechaCompra').value,
                tipo: document.getElementById('tipoInsumo').value,
                unidad: document.getElementById('unidadMedida').value,
                cantidad: parseFloat(document.getElementById('cantidadInsumo').value),
                disponible: parseFloat(document.getElementById('cantidadInsumo').value), // Nueva propiedad
                valor: parseFloat(document.getElementById('valorUnitario').value),
                total: parseFloat(document.getElementById('totalInsumo').textContent.replace(/,/g, ''))
            };

            if (editandoInsumo) {
                // Mantener el c√°lculo de disponibilidad al editar
                const original = insumos[indiceEdicionInsumo];
                insumo.disponible = original.disponible + (insumo.cantidad - original.cantidad);
                
                insumos[indiceEdicionInsumo] = insumo;
                editandoInsumo = false;
            } else {
                insumos.push(insumo);
            }

            actualizarSelectInsumos();
            actualizarTablaInsumos();
            document.getElementById('insumosForm').reset();
        }

        function actualizarTablaInsumos() {
            const tbody = document.getElementById('registrosInsumos');
            tbody.innerHTML = insumos.map((insumo, index) => `
                <tr>
                    <td>${insumo.fecha}</td>
                    <td>${insumo.tipo}</td>
                    <td>${insumo.unidad}</td>
                    <td>${insumo.cantidad}</td>
                    <td>${insumo.disponible}</td>
                    <td>$${insumo.valor.toLocaleString()}</td>
                    <td>$${insumo.total.toLocaleString()}</td>
                    <td>
                        <button onclick="editarInsumo(${index})">Editar</button>
                        <button onclick="eliminarInsumo(${index})">Eliminar</button>
                    </td>
                </tr>
            `).join('');
        }

        function editarInsumo(index) {
            const insumo = insumos[index];
            document.getElementById('fechaCompra').value = insumo.fecha;
            document.getElementById('tipoInsumo').value = insumo.tipo;
            document.getElementById('unidadMedida').value = insumo.unidad;
            document.getElementById('cantidadInsumo').value = insumo.cantidad;
            document.getElementById('valorUnitario').value = insumo.valor;
            
            editandoInsumo = true;
            indiceEdicionInsumo = index;
            calcularTotalInsumo();
        }

        function eliminarInsumo(index) {
            insumos.splice(index, 1);
            actualizarTablaInsumos();
        }

        // Funciones para Uso de Insumos
        function actualizarSelectInsumos() {
            const selectLotes = document.getElementById('loteUsoInsumo');
            const selectInsumos = document.getElementById('insumoDisponible');
            
            // Actualizar lotes
            selectLotes.innerHTML = lotes.map(lote => 
                `<option value="${lote.numero}">Lote ${lote.numero}</option>`
            ).join('');
            
            // Actualizar insumos con disponibilidad
            selectInsumos.innerHTML = insumos
                .filter(insumo => insumo.disponible > 0)
                .map((insumo, index) => 
                    `<option value="${index}">${insumo.tipo} (${insumo.disponible} ${insumo.unidad})</option>`
                ).join('');
        }

        function registrarUsoInsumo() {
            const loteNumero = parseInt(document.getElementById('loteUsoInsumo').value);
            const insumoIndex = parseInt(document.getElementById('insumoDisponible').value);
            const cantidad = parseFloat(document.getElementById('cantidadUso').value);
            const fecha = document.getElementById('fechaUso').value;

            const insumo = insumos[insumoIndex];
            
            // Validar disponibilidad
            if (cantidad > insumo.disponible) {
                alert(`No hay suficiente stock! Disponible: ${insumo.disponible} ${insumo.unidad}`);
                return;
            }

            // Actualizar inventario
            insumo.disponible -= cantidad;
            
            // Registrar uso
            const uso = {
                lote: loteNumero,
                insumo: insumo.tipo,
                cantidad: cantidad,
                unidad: insumo.unidad,
                fecha: fecha
            };
            
            usoInsumos.push(uso);
            
            // Actualizar lotes con el insumo usado
            const lote = lotes.find(l => l.numero === loteNumero);
            if (!lote.insumosUsados) lote.insumosUsados = [];
            lote.insumosUsados.push(uso);

            actualizarSelectInsumos();
            actualizarTablaUsoInsumos();
            document.getElementById('usoInsumosForm').reset();
        }

        function actualizarTablaUsoInsumos() {
            const tbody = document.getElementById('registrosUsoInsumos');
            tbody.innerHTML = usoInsumos.map(uso => `
                <tr>
                    <td>${uso.lote}</td>
                    <td>${uso.insumo}</td>
                    <td>${uso.cantidad}</td>
                    <td>${uso.unidad}</td>
                    <td>${uso.fecha}</td>
                </tr>
            `).join('');
        }

        // Event listeners
        document.getElementById('jornales').addEventListener('input', calcularTotal);
        document.getElementById('valorJornal').addEventListener('input', calcularTotal);
        document.getElementById('cantidadInsumo').addEventListener('input', calcularTotalInsumo);
        document.getElementById('valorUnitario').addEventListener('input', calcularTotalInsumo);
        document.addEventListener('DOMContentLoaded', () => {
            actualizarLotesSelector();
            actualizarSelectInsumos();
        });
    </script>
</body>
</html>
