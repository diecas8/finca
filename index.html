<!-- Esto es como tu cuaderno m√°gico ‚ú® -->
<!DOCTYPE html>
<html>
<head>
    <title>Finca Caf√© M√°gico üå±</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .seccion { background: #e0f7fa; padding: 20px; margin: 10px; border-radius: 10px; }
        input, button { margin: 5px; padding: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
<head>
    <title>Finca Caf√© M√°gico üå±</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            color: #333;
        }

        .seccion {
            background-color: #e0f7fa;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        input, select {
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 5px;
            width: 100%;
            margin-bottom: 10px;
        }

        input:focus, select:focus {
            border-color: #4CAF50;
        }
    </style>
</head>

<div class="seccion">
    <h2>üìã Informaci√≥n de la Finca</h2>
    <form onsubmit="guardarFinca(event)">
        <div class="columnas-magicas">
            <div>
                <label>Nombre de la finca:</label>
                <input type="text" id="nombreFinca" required>
                
                <label>√Årea total (hect√°reas):</label>
                <input type="number" step="0.01" id="areaTotal" required>
                
                <label>Propietario:</label>
                <input type="text" id="propietario" required>
            </div>
            
            <div>
                <label>Vereda:</label>
                <input type="text" id="vereda" required>
                
                <label>Municipio:</label>
                <input type="text" id="municipio" required>
                
                <label>√Årea en caf√© (auto):</label>
                <input type="number" step="0.01" id="areaCafe" readonly>
            </div>
        </div>
        <button type="submit">üíæ Guardar</button>
    </form>
</div>

<div class="seccion">
    <h2>üõí Compras de Insumos</h2>
    <input type="date" id="fechaCompra">
    <input type="text" id="insumo" placeholder="Nombre del insumo">
    <input type="number" step="0.01" id="cantidadCompra" placeholder="Cantidad">
    <button onclick="comprarInsumo()">üõí Agregar</button>
</div>

<div class="seccion">
    <h2>üì¶ Bodega de Insumos (Mejorada)</h2>
    <table id="tablaBodega">
        <tr>
            <th>Insumo</th>
            <th>Unidad</th>
            <th>En Stock</th>
            <th>√öltima Compra</th>
            <th>Total Usado</th>
            <th>Disponible</th>
        </tr>
    </table>
</div>

<div class="seccion">
    <h2>üå± Lotes de Caf√©</h2>
    <div class="columnas-magicas">
        <div>
            <label>N√∫mero de lote:</label>
            <input type="text" id="numLote" placeholder="Ej: Lote 1">
            
            <label>√Årea (hect√°reas):</label>
            <input type="number" step="0.01" id="areaLote" oninput="calcularPlantas()" placeholder="Ej: 1.50">
            
            <label>Distancia entre calles (metros):</label>
            <input type="number" step="0.01" id="distanciaCalles" oninput="calcularPlantas()" placeholder="Ej: 2.50">
        </div>
        
        <div>
            <label>Distancia entre plantas (metros):</label>
            <input type="number" step="0.01" id="distanciaPlantas" oninput="calcularPlantas()" placeholder="Ej: 1.20">
            
            <label>Densidad (plantas/ha):</label>
            <input type="text" id="densidad" readonly style="background: #e0f7fa;">
            
            <label>Total de plantas:</label>
            <input type="text" id="numPlantas" readonly style="background: #e0f7fa;">
        </div>
    </div>
    <button onclick="guardarLote()">üíæ Guardar Lote</button>
</div>

<div class="seccion">
    <h2>üì¶ Usar Insumos en Lotes</h2>
    <select id="loteUso">
        <option>Elige un lote</option>
    </select>
    <select id="insumoUso">
        <option>Elige insumo</option>
    </select>
    <input type="number" step="0.01" id="cantidadUso" placeholder="Cantidad a usar">
    <button onclick="usarInsumo()">‚ûñ Usar</button>
</div>
    <div class="seccion">
    <h2>üìä Reporte de Lotes de Caf√©</h2>
    <button onclick="generarReporteLotes()">üñ®Ô∏è Generar Reporte</button>
    <table id="reporteLotes">
        <thead>
            <tr>
                <th>N√∫mero</th>
                <th>√Årea (ha)</th>
                <th>Densidad (plantas/ha)</th>
                <th>Total Plantas</th>
            </tr>
        </thead>
        <tbody>
            <!-- Aqu√≠ se llenar√°n los datos -->
        </tbody>
    </table>
</div>
    <div class="seccion">
    <h2>üìä Reporte de Insumos</h2>
    <button onclick="generarReporteInsumos()">üñ®Ô∏è Generar Reporte</button>
    <table id="reporteInsumos">
        <thead>
            <tr>
                <th>Insumo</th>
                <th>Unidad</th>
                <th>En Stock</th>
                <th>Disponible</th>
            </tr>
        </thead>
        <tbody>
            <!-- Aqu√≠ se llenar√°n los datos -->
        </tbody>
    </table>
</div>
    <div class="seccion">
    <h2>üìä Reporte de Actividades</h2>
    <button onclick="generarReporteActividades()">üñ®Ô∏è Generar Reporte</button>
    <table id="reporteActividades">
        <thead>
            <tr>
                <th>Lote</th>
                <th>Actividad</th>
                <th>Jornales</th>
                <th>Costo Total</th>
            </tr>
        </thead>
        <tbody>
            <!-- Aqu√≠ se llenar√°n los datos -->
        </tbody>
    </table>
</div>

    <script>
        let bodega = {};
let lotes = [];
let usandoInsumoEditIndex = -1;
        let datosFinca = {
            nombre: "",
            areaTotal: 0,
            propietario: "",
            vereda: "",
            municipio: ""
        };

        function guardarFinca(event) {
    event.preventDefault();
    
    const nombre = document.getElementById('nombreFinca').value;
    const areaTotal = parseFloat(document.getElementById('areaTotal').value);
    const propietario = document.getElementById('propietario').value;
    const vereda = document.getElementById('vereda').value;
    const municipio = document.getElementById('municipio').value;

    if (!nombre || !areaTotal || !propietario || !vereda || !municipio) {
        alert("üö® ¬°Todos los campos deben ser llenados!");
        return; // Detenemos la funci√≥n si falta algo
    }

    // Guardamos la finca
    datosFinca = { nombre, areaTotal, propietario, vereda, municipio };
    localStorage.setItem('datosFinca', JSON.stringify(datosFinca));
    alert("‚úÖ ¬°Informaci√≥n de la finca guardada!");
}


        function actualizarAreaCafe() {
            const total = lotes.reduce((sum, lote) => sum + parseFloat(lote.area), 0);
            document.getElementById('areaCafe').value = total.toFixed(2);
        }
           function calcularPlantas() {
    // üßô‚Äç‚ôÇÔ∏è Capturamos los valores del formulario
    const area = parseFloat(document.getElementById('areaLote').value) || 0;
    const calles = parseFloat(document.getElementById('distanciaCalles').value) || 0;
    const plantas = parseFloat(document.getElementById('distanciaPlantas').value) || 0;

    // üö® Validamos que las distancias no sean cero
    if (calles > 0 && plantas > 0) {
        // ‚ú® F√≥rmula m√°gica de densidad (plantas por hect√°rea)
        const densidad = 10000 / (calles * plantas); // 10,000 m¬≤ = 1 hect√°rea
        document.getElementById('densidad').value = densidad.toFixed(2); // Mostramos con 2 decimales

        // üå± C√°lculo de plantas totales
        const totalPlantas = area * densidad;
        document.getElementById('numPlantas').value = Math.round(totalPlantas); // Redondeamos
    } else {
        // üßπ Si hay errores, limpiamos los campos
        document.getElementById('densidad').value = '';
        document.getElementById('numPlantas').value = '';
    }
}
           function guardarLote() {
    // Obtenemos los valores del formulario
    const numeroLote = document.getElementById('numLote').value;
    const area = parseFloat(document.getElementById('areaLote').value);
    const distanciaCalles = parseFloat(document.getElementById('distanciaCalles').value);
    const distanciaPlantas = parseFloat(document.getElementById('distanciaPlantas').value);
    const densidad = document.getElementById('densidad').value;
    const numPlantas = document.getElementById('numPlantas').value;

    // Validamos si los campos son v√°lidos
    if (!numeroLote || isNaN(area) || isNaN(distanciaCalles) || isNaN(distanciaPlantas) || isNaN(densidad) || isNaN(numPlantas)) {
        alert("üö® ¬°Por favor, completa todos los campos correctamente!");
        return;
    }

    // Creamos un objeto con los datos del lote
    const nuevoLote = {
        numero: numeroLote,
        area: area,
        distanciaCalles: distanciaCalles,
        distanciaPlantas: distanciaPlantas,
        densidad: densidad,
        numPlantas: numPlantas
    };

    // Recuperamos los lotes ya guardados en el localStorage
    let lotesGuardados = JSON.parse(localStorage.getItem('lotes')) || [];

    // A√±adimos el nuevo lote a la lista
    lotesGuardados.push(nuevoLote);

    // Guardamos la lista actualizada de lotes
    localStorage.setItem('lotes', JSON.stringify(lotesGuardados));

    // Actualizamos la lista de lotes en la p√°gina
    actualizarListaLotes();

    // Mostramos mensaje de √©xito
    alert("‚úÖ ¬°Lote guardado exitosamente!");

    // Limpiamos el formulario
    document.getElementById('loteForm').reset();
}

            // ‚ñº‚ñº‚ñº Comprar Insumos ‚ñº‚ñº‚ñº
   function comprarInsumo() {
    const insumo = document.getElementById('insumo').value;
    const cantidad = parseFloat(document.getElementById('cantidadCompra').value);

    if (!insumo || cantidad <= 0) {
        alert("üö® ¬°Debes ingresar un insumo y una cantidad v√°lida!");
        return;
    }

    if (bodega[insumo]) {
        bodega[insumo].existencia += cantidad;
    } else {
        bodega[insumo] = { existencia: cantidad, unidad: 'kg' };
    }

    actualizarBodega();
    alert(`‚úÖ ¬°Agregados ${cantidad} kg de ${insumo}!`);
}

            // ‚ñº‚ñº‚ñº Actualizar Bodega ‚ñº‚ñº‚ñº
    function actualizarBodega() {
        const tabla = document.getElementById('tablaBodega');
        tabla.innerHTML = `
            <tr>
                <th>Insumo</th>
                <th>Unidad</th>
                <th>En Stock</th>
                <th>√öltima Compra</th>
                <th>Total Usado</th>
                <th>Disponible</th>
            </tr>`;

        for (let insumo in bodega) {
            tabla.innerHTML += `
                <tr>
                    <td>${insumo}</td>
                    <td>${bodega[insumo].unidad}</td>
                    <td>${bodega[insumo].existencia.toFixed(2)}</td>
                    <td>${new Date().toLocaleDateString()}</td>
                    <td>0.00</td>
                    <td>${bodega[insumo].existencia.toFixed(2)}</td>
                </tr>`;
        }
    }
      function actualizarListaLotes() {
    // Obtenemos el elemento select donde se van a mostrar los lotes
    const selectLotes = document.getElementById('loteUso');
    
    // Limpiamos el select para evitar duplicados
    selectLotes.innerHTML = `<option>Elige un lote</option>`;  // Esta opci√≥n es por defecto
    
    // Recuperamos los lotes guardados desde localStorage
    const lotesGuardados = JSON.parse(localStorage.getItem('lotes')) || [];

    // A√±adimos cada lote al select
    lotesGuardados.forEach(lote => {
        const option = document.createElement('option');
        option.value = lote.numero;  // N√∫mero del lote
        option.textContent = `Lote ${lote.numero}`;  // Mostramos "Lote 1", "Lote 2", etc.
        selectLotes.appendChild(option);  // Agregamos la opci√≥n al select
    });
}


  function usarInsumo() {
    const loteSeleccionado = document.getElementById('loteUso').value;
    const insumoSeleccionado = document.getElementById('insumoUso').value;
    const cantidad = parseFloat(document.getElementById('cantidadUso').value);

    // Validamos que el lote, el insumo y la cantidad sean correctos
    if (!loteSeleccionado || !insumoSeleccionado || cantidad <= 0) {
        alert("üö® ¬°Por favor, selecciona un lote, un insumo y una cantidad v√°lida!");
        return;
    }

    // Verificamos si hay suficiente cantidad de insumo
    if (bodega[insumoSeleccionado] && bodega[insumoSeleccionado].existencia >= cantidad) {
        bodega[insumoSeleccionado].existencia -= cantidad;
        actualizarBodega();  // Actualizamos la bodega con el nuevo stock
        alert(`‚úÖ ¬°${cantidad} kg de ${insumoSeleccionado} usados en el Lote ${loteSeleccionado}!`);
    } else {
        alert("üö® ¬°No tienes suficiente cantidad de este insumo en la bodega!");
    }
}
   window.onload = function () {
    // üóÑÔ∏è Cargamos los lotes del "cofre del tesoro"
    let lotesGuardados = JSON.parse(localStorage.getItem('lotes')) || [];
    lotes = lotesGuardados; // Los ponemos en la memoria

    // üé® Actualizamos la interfaz
    actualizarBodega();
    actualizarAreaCafe();
};
      function generarReporteLotes() {
    const lotes = JSON.parse(localStorage.getItem('lotes')) || [];
    const tbody = document.getElementById('reporteLotes').querySelector('tbody');
    tbody.innerHTML = ''; // Limpiamos la tabla

    if (lotes.length === 0) {
        alert("üö® No hay lotes guardados para mostrar.");
        return;
    }

    lotes.forEach(lote => {
        const fila = `
            <tr>
                <td>${lote.numero}</td>
                <td>${lote.area}</td>
                <td>${lote.densidad}</td>
                <td>${lote.numPlantas}</td>
            </tr>`;
        tbody.innerHTML += fila;
    });

    alert("‚úÖ ¬°Reporte de lotes generado!");
}

       function generarReporteInsumos() {
    const bodega = JSON.parse(localStorage.getItem('bodega')) || {};
    const tbody = document.getElementById('reporteInsumos').querySelector('tbody');
    tbody.innerHTML = ''; // Limpiamos la tabla

    if (Object.keys(bodega).length === 0) {
        alert("üö® No hay insumos guardados para mostrar.");
        return;
    }

    for (let insumo in bodega) {
        const fila = `
            <tr>
                <td>${insumo}</td>
                <td>${bodega[insumo].unidad}</td>
                <td>${bodega[insumo].existencia.toFixed(2)}</td>
                <td>${bodega[insumo].existencia.toFixed(2)}</td>
            </tr>`;
        tbody.innerHTML += fila;
    }

    alert("‚úÖ ¬°Reporte de insumos generado!");
}

        function generarReporteActividades() {
    const actividades = JSON.parse(localStorage.getItem('actividades')) || [];
    const tbody = document.getElementById('reporteActividades').querySelector('tbody');
    tbody.innerHTML = ''; // Limpiamos la tabla

    actividades.forEach(act => {
        const fila = `
            <tr>
                <td>${act.lote}</td>
                <td>${act.nombre}</td>
                <td>${act.jornales}</td>
                <td>${act.total}</td>
            </tr>`;
        tbody.innerHTML += fila;
    });

    alert("‚úÖ Reporte generado");
}
        window.onload = function () {
   actualizarListaLotes();  // Actualizamos la lista de lotes al cargar la p√°gina
    actualizarBodega();  // Aseguramos que los insumos tambi√©n se actualicen
};

</script>

</body>
</html>
